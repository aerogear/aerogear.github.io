<!doctype html>
<html>
<head>
  <title>AeroGear - Cryptography support</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Main styles-->
  <link href="/css/styles.css" rel="stylesheet" media="screen">

  <!-- Syntax highlighting -->
  <link href="/css/syntax.css" rel="stylesheet"> 

  <!-- Icons -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/openshift-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>


  <!-- google analytics -->
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28733717-2']);
      _gaq.push(['_setDomainName', 'aerogear.org']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>
  

</head>

<body>    

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/index.html">AeroGear</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        

        <li class="">
          <a href="/">Home</a>
        </li>

        <li class="">
          <a href="/getting-started/overview/">Getting Started</a>
        </li>


        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile Services<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
              <li><a href="/services/push/">Push Notifications</a></li>
              <li><a href="/services/metrics/">Metrics</a></li>
              <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
              <li><a href="/services/identity-management/">Identity Management</a></li>
              <li><a href="/services/device-security/">Device Security</a></li>
            </ul>
        </li>

        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile SDKs<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/sdks/android/">Android</a></li>
            <li><a href="/sdks/cordova/">Cordova</li>
            <li><a href="/sdks/ios/">iOS</a></li>
            <li><a href="/sdks/xamarin/">Xamarin</a></li>
          </ul>
        </li>

        <li class="hidden-sm ">
          <a href="https://docs.aerogear.org">Docs</a>
        </li>
   
        
        <li class="">
          <a href="/community">Community</a>
        </li>
        

        <li class="">
          <a href="/news">News</a>
        </li>
        
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="main-banner">
  <div class="container">
    
  <h2>Aerogear Guides <small>Tutorials to help get you off and running.</small></h2>

  </div><!-- container -->
</section> <!-- main banner -->


<section class="guides">
  
  <div class="container">
         <ol class="breadcrumb" style="margin:0">
      <li>
        
          <a href="/getstarted/guides/">Guides</a>
        
      </li>
      <li class="active">Cryptography support</li>
    </ol>
  </div><!-- container -->


  <div class="container">
    <div class="row">
      
      <div class="col-md-3 hidden-sm hidden-xs sidebar">
        <ul class="nav">
   <li class="toc_level-1 toc_section-1">
      <a href="#_symmetric_encryption_api">
         <span class="toctext">Symmetric encryption API</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-2">
      <a href="#_encrypted_storage">
         <span class="toctext">Encrypted storage</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-3">
      <a href="#_aerogear_crypto_password">
         <span class="toctext">AeroGear Crypto Password</span>
      </a>
   </li>
</ul>
      </div><!-- col -->
      
      <div class="col-md-9 post">
      
        <h1>Cryptography support</h1>
        <div class="paragraph">
<p>Since 1.3.0 release of the library, we&#8217;ve built on the security foundation provided by <a href="https://github.com/aerogear/aerogear-crypto-ios">aerogear-crypto-ios</a>
to offer encrypted variants of our existing in-memory, plist and sqlite data stores. If you have been using the existing data stores to persist
your data, you will be happy to know that you can easily switch to an encrypted variant by simple changing the
type and some small (really!) amount of code to provide the necessary crypto params.
Let&#8217;s start with a small primer to symmetric encryption, which is primary cryptography mechanism used
to encrypt the data stores.</p>
</div>
<div class="sect1">
<h2 id="_symmetric_encryption_api">Symmetric encryption API</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Symmetric encryption (also called private key encryption) is when the same key is used to encrypt and decrypt data. It is best defined with the following concepts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Encryption key</strong> is a block of bytes of a <em>specific length</em>. Key can be derived from password using for example, PBKDF2 algorithm. Must be kept secret.</p>
</li>
<li>
<p><strong>IV (Initialization Vector)</strong> is a random value that is used to encrypt data. Encryption algorithms usually work on fixed-size blocks, IV defines the first encrypted block.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>You can derive the encryption key using a password or passphrase and salt with <a href="/docs/specs/aerogear-ios-crypto/Classes/AGPBKDF2.html">AGPBKDF2</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>Password</strong> is easy to remember and usually defined by user and must be kept secret. A password is not a key.</p>
</li>
<li>
<p><strong>Salt</strong> is a random value that is used together with a password to derive an encryption key. A salt value does not need to be kept secret.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>AeroGear-Crypto symmetric encryption is powered by <a href="http://nacl.cr.yp.to/">NaCl</a>. Using <a href="http://cr.yp.to/ecdh/curve25519-20060209.pdf">Curve 25519 algorithms</a>,
it provides you an easy way to encrypt your sensitive data. No need to be a security expert to use the library. See by yourself.</p>
</div>
<div class="paragraph">
<p>First of all, to encrypt your data you need an encryption key. Your key can be derived from a PIN, password or passphrase using <a href="/docs/specs/aerogear-ios-crypto/Classes/AGPBKDF2.html">AGPBKDF2</a>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">    NSData *salt = [AGRandomGenerator randomBytes];
    NSData *encryptionKey = [pbkdf2 deriveKey:@"password4me" salt:salt];</code></pre>
</div>
</div>
<div class="paragraph">
<p>For random generation of key, salt or IV, use <a href="/docs/specs/aerogear-ios-crypto/Classes/AGRandomGenerator.html">AGRandomGenerator</a>. By default, AGRandomGenerator generates 16 bytes key, but you can also specify the length if you wish.</p>
</div>
<div class="paragraph">
<p>Once you&#8217;ve got your encryption key, use <a href="/docs/specs/aerogear-ios-crypto/Classes/AGSecretBox.html">AGSecretBox</a> to do the actual encryption. Its interface is simple:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">@interface AGSecretBox : NSObject
- (id)initWithKey:(NSData*)key;
- (NSData*)encrypt:(NSData*)data IV:(NSData*)IV;
- (NSData*)decrypt:(NSData*)data IV:(NSData*)IV;
@end</code></pre>
</div>
</div>
<div class="paragraph">
<p>With <a href="/docs/specs/aerogear-ios-crypto/Classes/AGSecretBox.html">AGSecretBox</a>, you can encrypt/decrypt data using your encryption key and a randomly generated IV (Initialization Vector) as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">    NSString* stringToEncrypt = @"I want to keep it secret";
    // encode string into data
    NSData* dataToEncrypt = [stringToEncrypt dataUsingEncoding:NSUTF8StringEncoding];
    NSData* IV = [AGRandomGenerator randomBytes:16];

    // init secretbox with a key
    AGSecretBox* secretBox = [[AGSecretBox alloc] initWithKey:encryptionKey];

    // encrypt
    NSData* encryptedData = [secretBox encrypt:dataToEncrypt IV:IV];

    // decrypt
    NSData* decryptedData = [secretBox decrypt:encryptedData IV:IV];</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
To be able to decrypt, you need the randomly generated IV and you can regenerate the key with the salt and the password (prompted on the fly).
It is not recommended to store either password or derived key. Salt and IV are not security sensitive in the sense that they can be stored.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_encrypted_storage">Encrypted storage</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If your storage information need to be encrypted, AeroGear provides convenient and transparent encrypted storage support. You can use encrypted stores with the same API as the plain ones.</p>
</div>
<div class="paragraph">
<p>Current available implementations are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><a href="/docs/specs/aerogear-ios/Classes/AGEncryptedMemoryStorage.html">Encrypted Memory</a> storage which allows you to work in-memory with sensitive data.</p>
</li>
<li>
<p><a href="/docs/specs/aerogear-ios/Classes/AGEncryptedPropertyListStorage.html">Encrypted Property List</a> storage implementation.</p>
</li>
<li>
<p><a href="/docs/specs/aerogear-ios/Classes/AGEncryptedSQLiteStorage.html">Encrypted SQLite</a> storage implementation.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>Prior to using an encrypted data store variant, we need to obtain an instance of an <a href="/docs/specs/aerogear-ios/Protocols/AGEncryptionService.html">EncryptionService</a> which we will set it as a configuration parameter when we first initialise the store. The store will then use that service to perform encryption and decryption of data. Let&#8217;s see how this works:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">    // randomly generate salt
    NSData *salt = [AGRandomGenerator randomBytes];  // [1]

    // set up crypto params configuration object
    AGPassphraseCryptoConfig *config = [[AGPassphraseCryptoConfig alloc] init];  // [2]
    [config setSalt:salt];  // 3
    [config setPassphrase:self.password.text];   // 4

    // initialize the encryption service passing the config
    id&lt;AGEncryptionService&gt; encService = [[AGKeyManager manager] keyService:config];  // [5]

    // access Store Manager
    AGDataManager *manager = [AGDataManager manager];  // 6

    // create store
    store = [manager store:^(id&lt;AGStoreConfig&gt; config) {
        [config setName:@"CredentialsStorage"];
        [config setType:@"ENCRYPTED_PLIST"];  // 7
        [config setEncryptionService:encService];  // 8
    }];

    // ok time to attempt reading..
    NSArray *data = [store readAll]) { // 9

    if (data)
        // decryption succeeded!</code></pre>
</div>
</div>
<div class="paragraph">
<p>In [1] we initialize a random <em>salt</em> that will be used in the encryption. In [2] we initialize an instance of a <a href="/docs/specs/aerogear-ios/Protocols/AGCryptoConfig.html">CryptoConfig</a> configuration object to set our crypto params. Here we use an <a href="/docs/specs/aerogear-ios/Classes/AGPassphraseCryptoConfig.html">PassphraseCryptoConfig</a> object, that sets the necessary crypto params for the PBKDF2 Encryption Service, mainly the salt [3] and the passphrase [4].</p>
</div>
<div class="paragraph">
<p>Now that we have setup the configuration, it&#8217;s time to obtain an instance of an <a href="/docs/specs/aerogear-ios/Protocols/AGEncryptionService.html">EncryptionService</a> and that&#8217;s exactly what we do in [5]. <a href="/docs/specs/aerogear-ios/Classes/AGKeyManager.html">KeyManager</a> parses the configuration and returns an instance of it. Because we passed an <a href="/docs/specs/aerogear-ios/Classes/AGPassphraseCryptoConfig.html">PassphraseCryptoConfig</a> object, a PBKDF2 encryption service would be returned.</p>
</div>
<div class="paragraph">
<p>In [6] we initialize our data store (an encrypted plist [7]), setting the encryption service we obtained earlier [8]. Reading and saving operations are done like all the other stores, but this time the data are transparently encrypted/decrypted.</p>
</div>
<div class="paragraph">
<p>In [9] we attempt to read data from the store. If that fails, then user supplied wrong crypto parameters (either passphrase or salt).</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_aerogear_crypto_password">AeroGear Crypto Password</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you want to see it all together, give a try to <a href="https://github.com/aerogear/aerogear-crypto-ios-demo">AeroGear Crypto Password</a> app.
This application shows you how using encrypted storage you can store in a central point all your passwords.</p>
</div>
</div>
</div>
      
      </div><!-- col 8 -->
    </div><!-- row -->
  </div><!-- container -->
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        <h5>Getting Started</h5>
        <ul class="list-unstyled">
          <li><a href="/getting-started/overview/">Overview</a></li>
          <li><a href="/getting-started/installation-and-configuration/">Installation &amp; Configuration</a></li>
          <li><a href="/getting-started/creating-mobile-apps/">Creating Mobile Apps</a></li>
          <li><a href="/getting-started/enabling-mobile-services/">Enabling Mobile Services</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile Services</h5>
        <ul class="list-unstyled">
         <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
         <li><a href="/services/push/">Push Notifications</a></li>
         <li><a href="/services/metrics/">Metrics</a></li>
         <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
         <li><a href="/services/identity-management/">Identity Management</a></li>
         <li><a href="/services/device-security/">Device Security</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile SDKs</h5>
        <ul class="list-unstyled">
         <li><a href="/sdks/android/">Android</a></li>
         <li><a href="/sdks/cordova/">Cordova</li>
         <li><a href="/sdks/ios/">iOS</a></li>
         <li><a href="/sdks/xamarin/">Xamarin</a></li>
        </ul>
      </div><!-- col -->
      
      <div class="col-sm-3">
        <h5>COMMUNITY</h5>
        <ul class="list-unstyled">
          <li><a target="_blank" href="https://github.com/aerogear/">GitHub - Aerogear</a></li>
          <li><a target="_blank" href="https://github.com/aerogearcatalog/">GitHub - Aerogear Catalog</a></li>
          <li><a target="_blank" href="https://issues.jboss.org/browse/AEROGEAR">Jira Repo Issues</a></li>
          <li><a  href="/community/contribution-guide/">Contribution Guide</a></li>
          <li><a target="_blank" href="https://groups.google.com/forum/#!forum/aerogear">Google Group</a></li>
          <li><a href="irc://irc.freenode.net/aerogear">IRC</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-12 follow">
        <h5>FOLLOW US</h5>
        <ul class="list-inline">
          <li><a target="_blank" href="https://www.twitter.com/aerogears"><i class="fa fa-twitter-square"></i> Twitter</a></li>
          <li><a target="_blank" href="https://www.facebook.com/AeroGearProject"><i class="fa fa-facebook-square"></i> Facebook</a></li>
          <li><a target="_blank" href="https://plus.google.com/106588661437153585722/posts"><i class="fa fa-google-plus-square"></i> Google+</a></li>
          <li><a target="_blank" href="/feed.atom"><i class="fa fa-rss-square"></i> Feed</a></li>
        </ul>
        
        <p>AeroGear project is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a></p>
      </div><!-- col -->
    
    </div><!-- row -->

  </div><!-- container -->

</footer><!-- footer -->

<section class="redhat">
  <div class="container">
    <p class="text-center">
      <a href="http://www.redhat.com/">
        <img src="/img/redhatlogo-wite.png" alt="redhatlogo-wite" width="130">
      </a>
    </p>       
  </div><!-- container -->
</section>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- <script src="/bower_components/jquery/dist/jquery.min.js"></script> -->

<!-- Include all compiled plugins (below), or include individual files as needed  -->  
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- My script -->
<script src="/js/script.js"></script>

</body>
</html>