<!doctype html>
<html>
<head>
  <title>AeroGear - Pipe and Pipeline</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Main styles-->
  <link href="/css/styles.css" rel="stylesheet" media="screen">

  <!-- Syntax highlighting -->
  <link href="/css/syntax.css" rel="stylesheet"> 

  <!-- Icons -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/openshift-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>


  <!-- google analytics -->
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28733717-2']);
      _gaq.push(['_setDomainName', 'aerogear.org']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>
  

</head>

<body>    

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/index.html">AeroGear</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        

        <li class="">
          <a href="/">Home</a>
        </li>

        <li class="">
          <a href="/getting-started/overview/">Getting Started</a>
        </li>


        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile Services<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
              <li><a href="/services/push/">Push Notifications</a></li>
              <li><a href="/services/metrics/">Metrics</a></li>
              <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
              <li><a href="/services/identity-management/">Identity Management</a></li>
              <li><a href="/services/device-security/">Device Security</a></li>
            </ul>
        </li>

        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile SDKs<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/sdks/android/">Android</a></li>
            <li><a href="/sdks/cordova/">Cordova</li>
            <li><a href="/sdks/ios/">iOS</a></li>
            <li><a href="/sdks/xamarin/">Xamarin</a></li>
          </ul>
        </li>

        <li class="hidden-sm ">
          <a href="https://docs.aerogear.org">Docs</a>
        </li>
   
        
        <li class="">
          <a href="/community">Community</a>
        </li>
        

        <li class="">
          <a href="/news">News</a>
        </li>
        
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="main-banner">
  <div class="container">
    
  <h2>Aerogear Guides <small>Tutorials to help get you off and running.</small></h2>

  </div><!-- container -->
</section> <!-- main banner -->


<section class="guides">
  
  <div class="container">
         <ol class="breadcrumb" style="margin:0">
      <li>
        
          <a href="/getstarted/guides/">Guides</a>
        
      </li>
      <li class="active">Pipe and Pipeline</li>
    </ol>
  </div><!-- container -->


  <div class="container">
    <div class="row">
      
      <div class="col-md-3 hidden-sm hidden-xs sidebar">
        <ul class="nav">
   <li class="toc_level-1 toc_section-1">
      <a href="#_creating_a_pipeline_and_a_pipe_object">
         <span class="toctext">Creating a Pipeline and a Pipe object</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-2">
            <a href="#_read_a_specific_object">
               <span class="toctext">Read a specific object</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-3">
            <a href="#_read_all_objects_from_the_server">
               <span class="toctext">Read all objects from the server</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-4">
            <a href="#_save_object">
               <span class="toctext">Save object</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-5">
            <a href="#update">
               <span class="toctext">Update object</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-6">
            <a href="#remove">
               <span class="toctext">Remove object</span>
            </a>
         </li>
      </ul>
   </li>
   <li class="toc_level-1 toc_section-7">
      <a href="#_multipart_upload">
         <span class="toctext">Multipart Upload</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-8">
            <a href="#_timeout">
               <span class="toctext">Timeout</span>
            </a>
         </li>
      </ul>
   </li>
   <li class="toc_level-1 toc_section-9">
      <a href="#_time_out_and_cancel_pending_operations">
         <span class="toctext">Time out and Cancel pending operations</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-10">
            <a href="#_timeout_2">
               <span class="toctext">Timeout</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-11">
            <a href="#_cancel">
               <span class="toctext">Cancel</span>
            </a>
         </li>
      </ul>
   </li>
</ul>
      </div><!-- col -->
      
      <div class="col-md-9 post">
      
        <h1>Pipe and Pipeline</h1>
        <div class="paragraph">
<p>A Pipe object represents a server connection. An object of this class is responsible to communicate with the server in order to perform read/write operations.</p>
</div>
<div class="paragraph">
<p>A Pipeline object represents a 'collection' of server connections (aka Pipes). It provides a standard way to communicate with the server no matter the data format or transport expected. It contains some simple management APIs to create and remove Pipe objects.</p>
</div>
<div class="sect1">
<h2 id="_creating_a_pipeline_and_a_pipe_object">Creating a Pipeline and a Pipe object</h2>
<div class="sectionbody">
<div class="paragraph">
<p>To create a pipeline, you need to use the AGPipeline class. Below is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// NSURL object:
NSURL* serverURL = [NSURL URLWithString:@"http://myserver.rhcloud.com/"];

// create the 'todo' pipeline, which points to the baseURL of the REST application
AGPipeline* todo = [AGPipeline pipelineWithBaseURL:serverURL];

// Add a REST pipe for the 'projects' endpoint
id&lt;AGPipe&gt; projects = [todo pipe:^(id&lt;AGPipeConfig&gt; config) {
    [config setName:@"projects"];
     // this is the default, can be emitted
    [config setType:@"REST"];
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the example above the 'projects' pipe points to an RESTful endpoint (<a href="http://myserver.rhcloud.com/projects" class="bare">http://myserver.rhcloud.com/projects</a>). However, technical details like RESTful APIs (e.g. HTTP PUT) are not exposed on the AGPipeline and AGPipe APIs. Below is shown how to get access to an actual pipe, from the AGPipeline object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// get access to the 'projects' pipe
id&lt;AGPipe&gt; projects = [todo pipeWithName:@"projects"];</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="_read_a_specific_object">Read a specific object</h3>
<div class="paragraph">
<p>The 'read:id' method allows you to fetch the object previously saved. The <a href="#noteid">id</a> of the object is used as the parameter.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// read an object with id of 1
[projects read:@"1" success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, where we have a RESTful pipe the API issues a HTTP GET request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_read_all_objects_from_the_server">Read all objects from the server</h3>
<div class="paragraph">
<p>The 'read' method allows to (currently) read <em>all</em> object from the server, of the underlying AGPipe:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">[projects read:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Since we are pointing to a RESTful endpoint, the API issues a HTTP GET request.</p>
</div>
</div>
<div class="sect2">
<h3 id="_save_object">Save object</h3>
<div class="paragraph">
<p>The AGPipe offers an API to store objects on a <em>remote</em> server resource. <strong>Currently</strong> the objects are <em>just</em> simple map objects. In the future we are looking to support more advanced (complex) frameworks, like Core Data. The 'save' method is described below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// create a dictionary and set some key/value data on it:
NSMutableDictionary* projectEntity = [@{@"title": @"Hello World"} mutableCopy];

// save the 'new' project:
[projects save:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"CREATE RESPONSE\n%@", [responseObject description]);

    // get the id of the new project, from the JSON response...
    id resourceId = [responseObject valueForKey:@"id"];

    // and update the 'object', so that it knows its ID...
    [projectEntity setValue:[resourceId stringValue] forKey:@"id"];

} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"SAVE: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Above the <em>save</em> function stores the given NSDictionary on the server. In this case, where we have a RESTful pipe the API issues a HTTP POST request.</p>
</div>
<div id="noteid" class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Upon success, we set the <a href="/docs/specs/aerogear-ios/Protocols/AGPipeConfig.html#//api/name/recordId">recordId</a> property on the object from the server response. This is a required step cause this property is used by Pipe&#8217;s <a href="#update">update</a> and <a href="#remove">remove</a> methods to perform operations on the object. By default, the <a href="/docs/specs/aerogear-ios/Protocols/AGPipe.html">Pipe</a> is configured to use the name <em>"id"</em>, but if your RESTful resource uses a different name, you can easily override it using the <a href="/docs/specs/aerogear-ios/Protocols/AGPipeConfig.html#//api/name/recordId">recordId</a> configuration option when constructing the <a href="/docs/specs/aerogear-ios/Protocols/AGPipe.html">Pipe</a>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="update">Update object</h3>
<div class="paragraph">
<p>The 'save' method is also responsible for updating an 'object'. Before performing 'save', ensure that the object you are trying to save, has the <a href="#noteid">recordId</a> property set.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// change the title of the previous project 'object':
[projectEntity setValue:@"Hello Update World!" forKey:@"title"];

// and now update it on the server
[projects save:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"UPDATE RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"UPDATE: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, where we have a RESTful pipe the API issues a HTTP PUT request.</p>
</div>
</div>
<div class="sect2">
<h3 id="remove">Remove object</h3>
<div class="paragraph">
<p>The AGPipe also contains a 'remove' method to delete the object on the server. As in the case of 'update', ensure that the <a href="#noteid">recordId</a> property is set, so that it knows which resource to delete.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// Now, just remove the project:
[projects remove:projectEntity success:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"DELETE RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"DELETE: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>In this case, where we have a RESTful pipe the API issues a HTTP DELETE request.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_multipart_upload">Multipart Upload</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Support for multipart upload is also provided. The types of data that can be uploaded are local files, instances of NSData and NSInputStream.
Let&#8217;s see how the upload mechanism works with an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// a multipart that contains a file
NSURL *file1 = &lt;path to a local file&gt;
AGFilePart *filePart = [[AGFilePart alloc]initWithFileURL:file1 name:@"myfile"];  // 1

// a multipart that contains an NSData object
NSData *data1 = [@"Lorem ipsum dolor sit amet.." dataUsingEncoding:NSUTF8StringEncoding];
AGFileDataPart *dataPart = [[AGFileDataPart alloc] initWithFileData:data1    // 2
                                                               name:@"data1"
                                                            fileName:@"data1.txt" mimeType:@"text/plain"];

// set up payload
NSDictionary *dict = @{@"somekey": @"somevalue",  // 3
                       @"another_key": @"some_other_key",
                       @"file1":filePart,
                       @"file2":dataPart};

// set an (optional) progress block  // 4
[[apiClient uploadPipe] setUploadProgressBlock:^(NSUInteger bytesWritten, long long totalBytesWritten, long long totalBytesExpectedToWrite) {
    NSLog(@"UPLOADPIPE Sent bytesWritten=%d totalBytesWritten=%qi of totalBytesExpectedToWrite=%qi bytes", bytesWritten, totalBytesWritten, totalBytesExpectedToWrite);
}];

// upload data
[[apiClient uploadPipe] save:dict success:^(id responseObject) {
    NSLog(@"Successfully uploaded!");

} failure:^(NSError *error) {
    NSLog(@"An error has occured during upload! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>An <a href="https://github.com/aerogear/aerogear-ios/blob/1.6.x/AeroGear-iOS/core/AGMultipart.h#L46">AGFilePart</a> [1] and <a href="https://github.com/aerogear/aerogear-ios/blob/1.6.x/AeroGear-iOS/core/AGMultipart.h#L64">AGFileDataPart</a> [2] objects are used to attach the data we want to upload. The former is initialized to point to a local file whereas the latter point to an NSData object respectively. Not shown in the example above, but an <a href="https://github.com/aerogear/aerogear-ios/blob/1.6.x/AeroGear-iOS/core/AGMultipart.h#L86">AGStreamPart</a> can be also used to read the data from a NSInputStream directly.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For NSData we need to explicitly specify both the <em>'filename'</em> and the <em>'MIME type'</em>, since they can not be automatically determined as with the case of a file.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>After initialization of the objects, we simply attach them to the payload [3], setting an (optional) progress block [4] so we can get notified during the upload.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Prior to version 1.4 of the library, multipart upload was supported by the means of attaching a <em>NSURL</em> object directly on the payload. The method is still supported, but it is now deprecated and will be removed in the future versions of the library.
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_timeout">Timeout</h3>

</div>
</div>
</div>
<div class="sect1">
<h2 id="_time_out_and_cancel_pending_operations">Time out and Cancel pending operations</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_timeout_2">Timeout</h3>
<div class="paragraph">
<p>During construction of the Pipe object, you can optionally specify a timeout interval (default is 60 secs) for an operation to complete. If the time interval is exceeded with no response from the server, then the <em>failure</em> callback is executed with an error code set to <em>NSURLErrorTimedOut</em>.</p>
</div>
<div class="paragraph">
<p>From the todo example above:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">id&lt;AGPipe&gt; projects = [todo pipe:^(id&lt;AGPipeConfig&gt; config) {
    ...
    [config setTimeout:20];  // set the time interval to 20 secs
}];</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you are running on iOS versions &lt; 6 and a timeout occurs on a pipe&#8217;s <em>save</em> operation, the error code is set to <em>NSURLErrorCancelled</em>.
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_cancel">Cancel</h3>
<div class="paragraph">
<p>At any time after starting your operations, you can call 'cancel' on the Pipe object to cancel all running Pipe operations. Doing so will invoke the pipe&#8217;s 'failure' block with an error code set to 'NSURLErrorCancelled'. You can then check this code in order to perform your "cancellation" logic.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">[projects read:^(id responseObject) {
    // LOG the JSON response, returned from the server:
    NSLog(@"READ RESPONSE\n%@", [responseObject description]);
} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];

 // cancel the request
[projects cancel];</code></pre>
</div>
</div>
</div>
</div>
</div>
      
      </div><!-- col 8 -->
    </div><!-- row -->
  </div><!-- container -->
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        <h5>Getting Started</h5>
        <ul class="list-unstyled">
          <li><a href="/getting-started/overview/">Overview</a></li>
          <li><a href="/getting-started/installation-and-configuration/">Installation &amp; Configuration</a></li>
          <li><a href="/getting-started/creating-mobile-apps/">Creating Mobile Apps</a></li>
          <li><a href="/getting-started/enabling-mobile-services/">Enabling Mobile Services</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile Services</h5>
        <ul class="list-unstyled">
         <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
         <li><a href="/services/push/">Push Notifications</a></li>
         <li><a href="/services/metrics/">Metrics</a></li>
         <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
         <li><a href="/services/identity-management/">Identity Management</a></li>
         <li><a href="/services/device-security/">Device Security</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile SDKs</h5>
        <ul class="list-unstyled">
         <li><a href="/sdks/android/">Android</a></li>
         <li><a href="/sdks/cordova/">Cordova</li>
         <li><a href="/sdks/ios/">iOS</a></li>
         <li><a href="/sdks/xamarin/">Xamarin</a></li>
        </ul>
      </div><!-- col -->
      
      <div class="col-sm-3">
        <h5>COMMUNITY</h5>
        <ul class="list-unstyled">
          <li><a target="_blank" href="https://github.com/aerogear/">GitHub - Aerogear</a></li>
          <li><a target="_blank" href="https://github.com/aerogearcatalog/">GitHub - Aerogear Catalog</a></li>
          <li><a target="_blank" href="https://issues.jboss.org/browse/AEROGEAR">Jira Repo Issues</a></li>
          <li><a  href="/community/contribution-guide/">Contribution Guide</a></li>
          <li><a target="_blank" href="https://groups.google.com/forum/#!forum/aerogear">Google Group</a></li>
          <li><a href="irc://irc.freenode.net/aerogear">IRC</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-12 follow">
        <h5>FOLLOW US</h5>
        <ul class="list-inline">
          <li><a target="_blank" href="https://www.twitter.com/aerogears"><i class="fa fa-twitter-square"></i> Twitter</a></li>
          <li><a target="_blank" href="https://www.facebook.com/AeroGearProject"><i class="fa fa-facebook-square"></i> Facebook</a></li>
          <li><a target="_blank" href="https://plus.google.com/106588661437153585722/posts"><i class="fa fa-google-plus-square"></i> Google+</a></li>
          <li><a target="_blank" href="/feed.atom"><i class="fa fa-rss-square"></i> Feed</a></li>
        </ul>
        
        <p>AeroGear project is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a></p>
      </div><!-- col -->
    
    </div><!-- row -->

  </div><!-- container -->

</footer><!-- footer -->

<section class="redhat">
  <div class="container">
    <p class="text-center">
      <a href="http://www.redhat.com/">
        <img src="/img/redhatlogo-wite.png" alt="redhatlogo-wite" width="130">
      </a>
    </p>       
  </div><!-- container -->
</section>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- <script src="/bower_components/jquery/dist/jquery.min.js"></script> -->

<!-- Include all compiled plugins (below), or include individual files as needed  -->  
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- My script -->
<script src="/js/script.js"></script>

</body>
</html>