<!doctype html>
<html>
<head>
  <title>AeroGear - Store and DataManager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Main styles-->
  <link href="/css/styles.css" rel="stylesheet" media="screen">

  <!-- Syntax highlighting -->
  <link href="/css/syntax.css" rel="stylesheet"> 

  <!-- Icons -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/openshift-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>


  <!-- google analytics -->
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28733717-2']);
      _gaq.push(['_setDomainName', 'aerogear.org']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>
  

</head>

<body>    

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/index.html">AeroGear</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        

        <li class="">
          <a href="/">Home</a>
        </li>

        <li class="">
          <a href="/getting-started/overview/">Getting Started</a>
        </li>


        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile Services<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
              <li><a href="/services/push/">Push Notifications</a></li>
              <li><a href="/services/metrics/">Metrics</a></li>
              <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
              <li><a href="/services/identity-management/">Identity Management</a></li>
              <li><a href="/services/device-security/">Device Security</a></li>
            </ul>
        </li>

        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile SDKs<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/sdks/android/">Android</a></li>
            <li><a href="/sdks/cordova/">Cordova</li>
            <li><a href="/sdks/ios/">iOS</a></li>
            <li><a href="/sdks/xamarin/">Xamarin</a></li>
          </ul>
        </li>

        <li class="hidden-sm ">
          <a href="https://docs.aerogear.org">Docs</a>
        </li>
   
        
        <li class="">
          <a href="/community">Community</a>
        </li>
        

        <li class="">
          <a href="/news">News</a>
        </li>
        
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="main-banner">
  <div class="container">
    
  <h2>Aerogear Guides <small>Tutorials to help get you off and running.</small></h2>

  </div><!-- container -->
</section> <!-- main banner -->


<section class="guides">
  
  <div class="container">
         <ol class="breadcrumb" style="margin:0">
      <li>
        
          <a href="/getstarted/guides/">Guides</a>
        
      </li>
      <li class="active">Store and DataManager</li>
    </ol>
  </div><!-- container -->


  <div class="container">
    <div class="row">
      
      <div class="col-md-3 hidden-sm hidden-xs sidebar">
        <ul class="nav">
   <li class="toc_level-1 toc_section-1">
      <a href="#_create_a_datamanager_with_store_object">
         <span class="toctext">Create a datamanager with store object:</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-2">
      <a href="#_save_data_to_the_store">
         <span class="toctext">Save data to the Store</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-3">
      <a href="#_read_an_object_from_the_store">
         <span class="toctext">Read an object from the Store</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-4">
      <a href="#_remove_one_object_from_the_store">
         <span class="toctext">Remove one object from the Store</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-5">
      <a href="#_filter_the_entire_store">
         <span class="toctext">Filter the entire store</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-6">
      <a href="#_reset_the_entire_store">
         <span class="toctext">Reset the entire store</span>
      </a>
   </li>
   <li class="toc_level-1 toc_section-7">
      <a href="#_propertylist_storage_specific">
         <span class="toctext">PropertyList Storage Specific</span>
      </a>
   </li>
</ul>
      </div><!-- col -->
      
      <div class="col-md-9 post">
      
        <h1>Store and DataManager</h1>
        <div class="paragraph">
<p>A Store represents an abstraction layer for a storage system. Currently implemented storage systems are an <a href="/docs/specs/aerogear-ios/Classes/AGMemoryStorage.html">in-memory</a>, <a href="/docs/specs/aerogear-ios/Classes/AGPropertyListStorage.html">property list</a> and a <a href="/docs/specs/aerogear-ios/Classes/AGSQLiteStorage.html">SQLite</a> storage (note that encrypted variants of these stores are also available, check the <a href="/docs/guides/aerogear-ios/Cryptography/">Cryptography support</a> section below).</p>
</div>
<div class="paragraph">
<p>A DataManager manages different Store implementations. It is basically a factory that hides the concrete instantiations of a specific Store implementation. The class offers simple APIs to add, remove or get access to a 'data store'.</p>
</div>
<div class="paragraph">
<p>The code snippets below are part of <a href="https://github.com/aerogear/aerogear-ios/tree/1.6.x/AeroGear-iOSTests">aerogear-ios test suite</a>. You can browse our BDD specifications for further samples.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Right now, there is NO automatic data sync. This is up to the user.
</td>
</tr>
</table>
</div>
<div class="sect1">
<h2 id="_create_a_datamanager_with_store_object">Create a datamanager with store object:</h2>
<div class="sectionbody">
<div class="paragraph">
<p>After receiving data from the server, your application may want to keep the data around. The AGDataManager API allows you to create AGStore instances. To create a datamanager, you need to use the AGDataManager class. Below is an example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// create the datamanager
AGDataManager* dm = [AGDataManager manager];
// add a new (default) store object:
id&lt;AGStore&gt; myStore = [dm store:^(id&lt;AGStoreConfig&gt; config) {
    [config setName:@"tasks"];
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The AGDataManager class offers some simple 'management' APIs to work with containing AGStore objects. The API offers read and write functionality. The default implementation represents an "in-memory" store. If you want to create a AGPropertyListStorage or a AGSQLiteStorage, add a config type as shown below:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// create the datamanager
AGDataManager* dm = [AGDataManager manager];
// add a new (default) store object:
id&lt;AGStore&gt; store = [dm store:^(id&lt;AGStoreConfig&gt; config) {
   [config setName:@"tasks"];
   [config setType:@"SQLITE"];
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>Storage can be of type:¬†MEMORY, PLIST or SQLITE. Similar to the pipe API technical details of the underlying system are not exposed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_save_data_to_the_store">Save data to the Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When using a pipe to read all entries of a endpoint, you can use the AGStore to save the received objects:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">id&lt;AGPipe&gt; tasksPipe = [todo get:@"tasks"];

[tasksPipe read:^(id responseObject) {
    // the response object represents an NSArray,
    // containing multile 'Tasks' (as NSDictionary objects)

    // Save the response object to the store
    NSError *error;

    if (![myStore save:responseObject error:&amp;error])
        NSLog(@"Save: An error occured during save! \n%@", error);

} failure:^(NSError *error) {
    // when an error occurs... at least log it to the console..
    NSLog(@"Read: An error occured! \n%@", error);
}];</code></pre>
</div>
</div>
<div class="paragraph">
<p>When loading all tasks from the server, the AGStore object is used inside of the <em>read</em> block from the AGPipe object. The returned collection of tasks is stored inside our in-memory store, from where the data can be accessed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_read_an_object_from_the_store">Read an object from the Store</h2>
<div class="sectionbody">
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// read the task with the '0' ID:
id taskObject =  [myStore read:@"0"];</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <em>read</em> function accepts the <em>recordID</em> of the object you want to retrieve. If the object does not exist in the store, <em>nil</em> is returned.</p>
</div>
<div class="paragraph">
<p>If you want to read <em>all</em> the objects contained in the store, simply call the <em>readAll</em> function</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// read all objects from the store
NSArray *objects = [myStore readAll];</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_remove_one_object_from_the_store">Remove one object from the Store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The remove function allows you to delete a single entry in the collection, if present:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// remove the taskObject:
NSError *error;

if (![myStore remove:taskObject error:error])
    NSLog(@"Save: An error occured during remove! \n%@", error);</code></pre>
</div>
</div>
<div class="paragraph">
<p>The remove method accepts a <em>taskObject</em> which is the object you want to remove. If the object does not exist in the store, FALSE is returned.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_filter_the_entire_store">Filter the entire store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Filtering of the data available in the AGStore is also supported, by using the familiar NSPredicate class available in iOS. In the following example, after storing a pair of dictionaries representing user information details in the store (which can be easily come from a response from a server), we simple call the <em>filter</em> method to filter out the desired information:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c"> NSMutableDictionary *user1 = [@{@"id" : @"1",
                                @"name" : @"Robert",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Cornwell"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"advanced"},
                                                  @{@"language" : @"C", @"level" : @"advanced"}]
                              } mutableCopy];

NSMutableDictionary *user2 = [@{@"id" : @"2",
                                @"name" : @"David",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Cornwell"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"intermediate"},
                                                  @{@"language" : @"Python", @"level" : @"intermediate"}]
                              } mutableCopy];

NSMutableDictionary *user3 = [@{@"id" : @"3",
                                @"name" : @"Peter",
                                @"city" : @"Boston",
                                @"department" : @{@"name" : @"Software", @"address" : @"Branton"},
                                @"experience" : @[@{@"language" : @"Java", @"level" : @"advanced"},
                                                  @{@"language" : @"C", @"level" : @"intermediate"}]
                              } mutableCopy];

// save objects
BOOL success = [_memStore save:users error:nil];

if (success) { // if save succeeded, query the data
    NSPredicate *predicate = [NSPredicate
                              predicateWithFormat:@"city = 'Boston' AND department.name = 'Software' \
                              AND SUBQUERY(experience, $x, $x.language = 'Java' AND $x.level = 'advanced').@count &gt; 0" ];

    NSArray *results = [_memStore filter:predicate];

    // The array now contains the dictionaries _user1_ and _user_3, since they both satisfy the query predicate.
    // do something with the 'results'
    // ...
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Using NSPredicate to filter desired data, is a powerful mechanism offered in iOS and we strongly suggest to familiarize yourself with it, if not already. Take a look at Apple&#8217;s own <a href="http://tinyurl.com/chmgwv5">documentation</a> for more information.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_reset_the_entire_store">Reset the entire store</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The reset function allows you the erase all data available in the used AGStore object:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-c" data-lang="c">// clears the entire store
NSError *error;

if (![myStore reset:&amp;error])
    NSLog(@"Reset: An error occured during reset! \n%@", error);</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_propertylist_storage_specific">PropertyList Storage Specific</h2>
<div class="sectionbody">
<div class="paragraph">
<p>A simple <em>Property list</em> storage system is part of the library as well that uses the same 'AGStore' protocol for reading and writing. Depending on the type specified during store configuration, the system will use either <a href="https://developer.apple.com/library/mac/documentation/cocoa/reference/foundation/Classes/NSPropertyListSerialization_Class/Reference/Reference.html">NSPropertyListSerialization</a> (type ''<em>PLIST</em>'') or <a href="https://developer.apple.com/library/mac/documentation/Foundation/Reference/NSJSONSerialization_Class/Reference/Reference.html">NSJSONSerialization</a> (type ''<em>JSON</em>'') when exporting data.</p>
</div>
<div class="paragraph">
<p>NOTE
You must adhere to the rules governing the serialization of data types for each respective plist type.</p>
</div>
<div class="paragraph">
<p>The 'read', 'reset' or 'remove' API behave the same, as on the default ("in memory") store.</p>
</div>
</div>
</div>
      
      </div><!-- col 8 -->
    </div><!-- row -->
  </div><!-- container -->
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        <h5>Getting Started</h5>
        <ul class="list-unstyled">
          <li><a href="/getting-started/overview/">Overview</a></li>
          <li><a href="/getting-started/installation-and-configuration/">Installation &amp; Configuration</a></li>
          <li><a href="/getting-started/creating-mobile-apps/">Creating Mobile Apps</a></li>
          <li><a href="/getting-started/enabling-mobile-services/">Enabling Mobile Services</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile Services</h5>
        <ul class="list-unstyled">
         <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
         <li><a href="/services/push/">Push Notifications</a></li>
         <li><a href="/services/metrics/">Metrics</a></li>
         <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
         <li><a href="/services/identity-management/">Identity Management</a></li>
         <li><a href="/services/device-security/">Device Security</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile SDKs</h5>
        <ul class="list-unstyled">
         <li><a href="/sdks/android/">Android</a></li>
         <li><a href="/sdks/cordova/">Cordova</li>
         <li><a href="/sdks/ios/">iOS</a></li>
         <li><a href="/sdks/xamarin/">Xamarin</a></li>
        </ul>
      </div><!-- col -->
      
      <div class="col-sm-3">
        <h5>COMMUNITY</h5>
        <ul class="list-unstyled">
          <li><a target="_blank" href="https://github.com/aerogear/">GitHub - Aerogear</a></li>
          <li><a target="_blank" href="https://github.com/aerogearcatalog/">GitHub - Aerogear Catalog</a></li>
          <li><a target="_blank" href="https://issues.jboss.org/browse/AEROGEAR">Jira Repo Issues</a></li>
          <li><a  href="/community/contribution-guide/">Contribution Guide</a></li>
          <li><a target="_blank" href="https://groups.google.com/forum/#!forum/aerogear">Google Group</a></li>
          <li><a href="irc://irc.freenode.net/aerogear">IRC</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-12 follow">
        <h5>FOLLOW US</h5>
        <ul class="list-inline">
          <li><a target="_blank" href="https://www.twitter.com/aerogears"><i class="fa fa-twitter-square"></i> Twitter</a></li>
          <li><a target="_blank" href="https://www.facebook.com/AeroGearProject"><i class="fa fa-facebook-square"></i> Facebook</a></li>
          <li><a target="_blank" href="https://plus.google.com/106588661437153585722/posts"><i class="fa fa-google-plus-square"></i> Google+</a></li>
          <li><a target="_blank" href="/feed.atom"><i class="fa fa-rss-square"></i> Feed</a></li>
        </ul>
        
        <p>AeroGear project is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a></p>
      </div><!-- col -->
    
    </div><!-- row -->

  </div><!-- container -->

</footer><!-- footer -->

<section class="redhat">
  <div class="container">
    <p class="text-center">
      <a href="http://www.redhat.com/">
        <img src="/img/redhatlogo-wite.png" alt="redhatlogo-wite" width="130">
      </a>
    </p>       
  </div><!-- container -->
</section>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- <script src="/bower_components/jquery/dist/jquery.min.js"></script> -->

<!-- Include all compiled plugins (below), or include individual files as needed  -->  
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- My script -->
<script src="/js/script.js"></script>

</body>
</html>