<!doctype html>
<html>
<head>
  <title>AeroGear - Digger installation guide</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Main styles-->
  <link href="/css/styles.css" rel="stylesheet" media="screen">

  <!-- Syntax highlighting -->
  <link href="/css/syntax.css" rel="stylesheet"> 

  <!-- Icons -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/openshift-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>


  <!-- google analytics -->
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28733717-2']);
      _gaq.push(['_setDomainName', 'aerogear.org']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>
  

</head>

<body>    

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/index.html">AeroGear</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        

        <li class="">
          <a href="/">Home</a>
        </li>

        <li class="">
          <a href="/getting-started/overview/">Getting Started</a>
        </li>


        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile Services<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
              <li><a href="/services/push/">Push Notifications</a></li>
              <li><a href="/services/metrics/">Metrics</a></li>
              <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
              <li><a href="/services/identity-management/">Identity Management</a></li>
              <li><a href="/services/device-security/">Device Security</a></li>
            </ul>
        </li>

        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile SDKs<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/sdks/android/">Android</a></li>
            <li><a href="/sdks/cordova/">Cordova</li>
            <li><a href="/sdks/ios/">iOS</a></li>
            <li><a href="/sdks/xamarin/">Xamarin</a></li>
          </ul>
        </li>

        <li class="hidden-sm ">
          <a href="https://docs.aerogear.org">Docs</a>
        </li>
   
        
        <li class="">
          <a href="/community">Community</a>
        </li>
        

        <li class="">
          <a href="/news">News</a>
        </li>
        
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="main-banner">
  <div class="container">
    
  <h2>Aerogear Guides <small>Tutorials to help get you off and running.</small></h2>

  </div><!-- container -->
</section> <!-- main banner -->


<section class="guides">
  
  <div class="container">
         <ol class="breadcrumb" style="margin:0">
      <li>
        
          <a href="/getstarted/guides/">Guides</a>
        
      </li>
      <li class="active">Digger installation guide</li>
    </ol>
  </div><!-- container -->


  <div class="container">
    <div class="row">
      
      <div class="col-md-3 hidden-sm hidden-xs sidebar">
        <ul class="nav">
   <li class="toc_level-1 toc_section-1">
      <a href="#_aerogear_digger_installation">
         <span class="toctext">AeroGear Digger Installation</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-2">
            <a href="#_installing_aerogear_digger_behind_proxy">
               <span class="toctext">Installing AeroGear Digger Behind Proxy</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-3">
            <a href="#_sample_jenkinsfiles_to_utilise_jenkins_pipelines">
               <span class="toctext">Sample jenkinsfiles To Utilise Jenkins Pipelines</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-4">
            <a href="#_prerequisites">
               <span class="toctext">Prerequisites</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-5">
            <a href="#macos-prereqs">
               <span class="toctext">macOS Prerequisites (optional)</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-6">
            <a href="#using-http-proxy">
               <span class="toctext">Using HTTP/HTTPS Proxy with Aerogear Digger (optional)</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-7">
            <a href="#macos-setup">
               <span class="toctext">Setup macOS Servers (optional)</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-8">
            <a href="#run-digger-installer">
               <span class="toctext">Run Digger Installer</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-9">
            <a href="#_nagios_installation_health_checks">
               <span class="toctext">Nagios Installation Health checks</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-10">
            <a href="#installer-variables">
               <span class="toctext">Installer Variables</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-11">
            <a href="#macos-variables">
               <span class="toctext">macOS Digger Variables</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-12">
            <a href="#_install_ruby">
               <span class="toctext">Install Ruby</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-13">
            <a href="#_install_node_js">
               <span class="toctext">Install Node.js</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-14">
            <a href="#_install_xcode">
               <span class="toctext">Install Xcode</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-15">
            <a href="#_download_apple_certificates">
               <span class="toctext">Download Apple certificates</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-16">
            <a href="#_update_cocoapods">
               <span class="toctext">Update Cocoapods</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-17">
            <a href="#_configure_build_farm_node">
               <span class="toctext">Configure Build Farm node</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-18">
            <a href="#known-issues">
               <span class="toctext">Known Issues</span>
            </a>
         </li>
      </ul>
   </li>
</ul>
      </div><!-- col -->
      
      <div class="col-md-9 post">
      
        <h1>Digger installation guide</h1>
        <div class="sect1">
<h2 id="_aerogear_digger_installation">AeroGear Digger Installation</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The AeroGear Digger project allows you to setup a Jenkins CI/CD server that utilizes Jenkins Pipelines for mobile application building. AeroGear Digger is deployed in OpenShift containers, providing isolated build environments.</p>
</div>
<div class="paragraph">
<p><a href="https://github.com/aerogear/aerogear-digger-installer" target="_blank" rel="noopener">aerogear-digger-installer</a> - GitHub repo with an <a href="http://docs.ansible.com/ansible/index.html" target="_blank" rel="noopener">Ansible</a> based tool, used for automated AeroGear Digger installation.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For more details about Ansible playbooks and variables, please refer to <a href="http://docs.ansible.com/ansible/playbooks_variables.html" target="_blank" rel="noopener">Ansible Playbook Variables Docs</a>.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Use the installation tool to create an OpenShift project and to deploy the following components in it:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Jenkins server, used to run the build tasks</p>
</li>
<li>
<p>Docker-formatted images with all tools required for Android application building</p>
</li>
<li>
<p>A Nagios server for health monitoring of installed components</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>If you want iOS building capability, the installer can optionally configure macOS server(s) with required tools. See <a href="#macos-setup">Setup macOS Servers (optional)</a>. These are not deployed in OpenShift project, but are connected as a Jenkins slaves to Jenkins master present in OpenShift project.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
If you choose to use macOS servers, their manual pre-configuration is required, see <a href="#macos-prereqs">macOS Prerequisites (optional)</a>
</td>
</tr>
</table>
</div>
<div class="sect2">
<h3 id="_installing_aerogear_digger_behind_proxy">Installing AeroGear Digger Behind Proxy</h3>
<div class="paragraph">
<p>It is possible to deploy Digger behind HTTP/HTTPS proxy that do not require authentication. see <a href="#using-http-proxy">Using HTTP/HTTPS Proxy with Aerogear Digger (optional)</a></p>
</div>
</div>
<div class="sect2">
<h3 id="_sample_jenkinsfiles_to_utilise_jenkins_pipelines">Sample jenkinsfiles To Utilise Jenkins Pipelines</h3>
<div class="paragraph">
<p>A suite of sample <code>jenkinsfiles</code> used for demonstration of application building using Jenkins pipeline is available in <a href="https://github.com/aerogear/aerogear-digger/tree/master/jenkinsfiles" target="_blank" rel="noopener">aerogear-digger GitHub repo</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="_prerequisites">Prerequisites</h3>
<div class="paragraph">
<p>Before running the Digger installer, please make sure the following prerequisites are met:</p>
</div>
<div class="sect3">
<h4 id="_proxy_configuration_optional">Proxy Configuration (optional)</h4>
<div class="paragraph">
<p>See <a href="#using-http-proxy">Using HTTP/HTTPS Proxy with Aerogear Digger (optional)</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_ansible_2_2_3_or_higher">Ansible 2.2.3 or higher</h4>
<div class="paragraph">
<p>Digger Installer requires a version of Ansible 2.2.3 or higher to be installed on node which will execute the Ansible playbook. You can check the installed Ansible version by running <code>ansible --version</code>.
Please refer to <a href="http://docs.ansible.com/ansible/intro_installation.html">Ansible installation instructions</a>.</p>
</div>
</div>
<div class="sect3">
<h4 id="_access_to_internet">Access to Internet</h4>
<div class="paragraph">
<p>Digger requires an outbound Internet access to perform npm installations. Make sure that all relevant nodes/servers have outbound Internet access.</p>
</div>
</div>
<div class="sect3">
<h4 id="_java_2_2_and_higher">Java 2.2 and higher</h4>
<div class="paragraph">
<p>Java is required for Jenkins configuration during the installation. Will be automatically installed if not present.</p>
</div>
</div>
<div class="sect3">
<h4 id="_openshift_3_3_or_higher">OpenShift 3.3 or higher</h4>
<div class="ulist">
<ul>
<li>
<p>An OpenShift Container Platform, and its command line tool (<a href="https://github.com/openshift/origin/releases/tag/v1.3.1" target="_blank" rel="noopener">oc</a>) installed locally.</p>
</li>
<li>
<p>OpenShift cluster with the following PVs (Persistent Volumes) available:</p>
<div class="ulist">
<ul>
<li>
<p>40GB for Jenkins</p>
</li>
<li>
<p>10GB for Android-sdk</p>
</li>
<li>
<p>1GB for Nagios</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_access_to_dockerhub">Access to DockerHub</h4>
<div class="paragraph">
<p>The installer retrieves the Docker-formatted images from <a href="https://hub.docker.com/" class="bare">https://hub.docker.com/</a>. Please make sure that all nodes in the OpenShift Installation have access to this site.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="macos-prereqs">macOS Prerequisites (optional)</h3>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Completing the steps presented in this section are only required to provision a macOS server to enable iOS app building with Aerogear Digger. Please skip to <a href="#run-digger-installer">Run Digger Installer</a> if you don&#8217;t need this functionality.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_recommended_macos_server_specifications">Recommended macOS Server Specifications:</h4>
<div class="ulist">
<ul>
<li>
<p>A fresh macOS 10.12 Sierra install (MacinCloud service can be used, too)</p>
</li>
<li>
<p>4GB RAM</p>
</li>
<li>
<p>2 CPU Cores</p>
</li>
<li>
<p>30GB minimum disk space and and additional 20GB per installed XCode version</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_macos_configuration_requirements">macOS Configuration Requirements</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Ansible requires SSH sudo access to the macOS server in order to correctly provision the server to support iOS builds.</p>
<div class="paragraph">
<p>Enable SSH connection by following these steps:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="#create-macos-sudo-user">Create a sudo macOS user</a></p>
</li>
<li>
<p><a href="#conf-remote-login-in-ansible-host">Configure Remote login(SSH) in Ansible</a></p>
</li>
<li>
<p><a href="#add-macos-sudo-into-playbook">Add macOS sudo user credentials into Ansible Inventory file</a></p>
</li>
</ul>
</div>
</li>
<li>
<p><a href="#provide-macos-with-internet">Provide macOS server with Internet access to list of hosts</a></p>
</li>
</ol>
</div>
</div>
<div class="sect3">
<h4 id="create-macos-sudo-user">Create a sudo macOS User</h4>
<div class="paragraph">
<p>Create a user with sudo permissions and SSH access on the macOS server.</p>
</div>
<div class="paragraph">
<p>An example bash script is provided.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Review the script before using it. The unmodified script will allow access to your machine with a default password. Change the default <code>PASSWORD</code> and ensure that <code>USER_ID</code> is unassigned.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>By default, the script will create a user named <code>jenkins</code> with <code>USER_ID=550</code> and add the user to the the <code>sudoers</code> file. The user&#8217;s <code>PASSWORD</code> is set by default to <code>Password1</code>. The user is added to the <code>admin</code> group.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Restart the server to implement the changes.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Download and execute the script with the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -O https://raw.githubusercontent.com/aerogear/aerogear-digger/master/admin/create-osx-user.sh
sudo bash create-osx-user.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash

USERNAME="jenkins"
PASSWORD="Password1"
REAL_NAME="Jenkins Agent"
GROUP_NAME="staff"

# the first user's id is 500, second is 501 ...
# picking a big number to be on the safe side.
# You can run this one to list UIDs
#   dscl . -list /Users UniqueID
USER_ID=550

# GID 20 is `staff`
GROUP_ID=20

############### end of parameters

. /etc/rc.common
dscl . create /Users/${USERNAME}
dscl . create /Users/${USERNAME} RealName ${REAL_NAME}
dscl . passwd /Users/${USERNAME} ${PASSWORD}

dscl . create /Users/${USERNAME} UniqueID ${USER_ID}
dscl . create /Users/${USERNAME} PrimaryGroupID ${GROUP_ID}
dscl . create /Users/${USERNAME} UserShell /bin/bash
dscl . create /Users/${USERNAME} NFSHomeDirectory /Users/${USERNAME}
dseditgroup -o edit -a ${USERNAME} -t user admin
cp -R /System/Library/User\ Template/English.lproj /Users/${USERNAME}
chown -R ${USERNAME}:${GROUP_NAME} /Users/${USERNAME}

echo "${USERNAME}  ALL=(ALL:ALL) ALL" &gt;&gt; /etc/sudoers

echo "Done creating OSX user - you may need to restart the osx server to apply all changes for the user ${USERNAME}"</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="conf-remote-login-in-ansible-host">Configure Remote Login(SSH) in Ansible Host</h4>
<div class="paragraph">
<p>Enable the remotely running Ansible process to execute commands on the macOS server via SSH.</p>
</div>
<div class="paragraph">
<p>A sample script is provided below. The <code>USERNAME</code> variable should contain the name of the macOS user created in the previous step.
This allows the <code>USERNAME</code> to access the server via SSH with a password.</p>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Review and understand the script before using it.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can also add a public encryption key to the <code>authorized_keys</code> file associated with the user. Private key of the asymmetric key pair is stored  on the Ansible management node.</p>
</div>
<div class="paragraph">
<p>The script can be downloaded and executed using the following commands:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">curl -O https://raw.githubusercontent.com/aerogear/aerogear-digger/master/admin/enable-osx-remote-login.sh
sudo bash enable-osx-remote-login.sh</code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">#!/usr/bin/env bash

# This script helps with enabling SSH for given OSX user.
# This script is not meant to be run in an automation. Run it manually.

USERNAME="jenkins"

# com.apple.access_ssh is a special group name on OSX.
# any user part of that group can have SSH connections in.
OSX_SSH_GROUP_NAME="com.apple.access_ssh"

systemsetup -setremotelogin on
# in order to check what groups are are there:
#   dscl . list /Groups PrimaryGroupID
# create a group for limiting SSH access
dseditgroup -o create -q ${OSX_SSH_GROUP_NAME}
# add user into this group
dseditgroup -o edit -a ${USERNAME} -t user ${OSX_SSH_GROUP_NAME}
# now, following should work  ---&gt; ssh username@localhost</code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="add-macos-sudo-into-inventory-file">Add macOS sudo Credentials into Ansible Inventory File</h4>
<div class="paragraph">
<p>A number of tasks in the <code>provision-osx</code> Ansible role used in the installer require <a href="http://docs.ansible.com/ansible/latest/become.html" target="_blank" rel="noopener">privilege escalation</a>.</p>
</div>
<div class="paragraph">
<p>Add the name of the macOS user created in previous steps as a variable <code>ansible_ssh_user</code> into the Ansible inventory file.</p>
</div>
<div class="paragraph">
<p>This allows Ansible to run commands as <code>sudo</code> user.</p>
</div>
<div class="paragraph">
<p>Set <code>ansible_sudo_pass</code> variable or <code>--ask-sudo-pass</code> flag with the user password to enable the installer to work with root permissions.</p>
</div>
</div>
<div class="sect3">
<h4 id="provide-macos-with-access-to-hosts">Provide macOS with Internet Access to List of Hosts</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Other external hosts may be required depending on what other packages you specify to install.
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 1. Hosts and resources they provide:</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Hostname</th>
<th class="tableblock halign-left valign-top">Provides</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com" class="bare">https://github.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Homebrew packages</code> and <code>Cocoapods</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://raw.githubusercontent.com" class="bare">https://raw.githubusercontent.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NVM - Node Version Manager</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://rvm.io" class="bare">https://rvm.io</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>RVM - Ruby Version Manager</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://developer.apple.com" class="bare">http://developer.apple.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>Apple Certificates</code> and <code>Xcode</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://npmjs.org" class="bare">https://npmjs.org</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>NPM packages</code></p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="using-http-proxy">Using HTTP/HTTPS Proxy with Aerogear Digger (optional)</h3>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
HTTP Proxies that require authentication are not supported.
Please read the <a href="#known-issues">Known Issues</a> for more details.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can install AeroGear Digger behind a proxy by modifying variables in Ansible playbook.</p>
</div>
<div class="paragraph">
<p>The installer will automatically configure the following components to use proxy (if the component requires an outbound Internet access):</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The Jenkins server</p>
</li>
<li>
<p>The Android SDK pod used to download Android SDKs</p>
</li>
<li>
<p>Container/node that will run the build jobs, by adding the environment variables such as <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code> in the inventory file.</p>
</li>
<li>
<p>macOS tools for iOS builds. See <a href="#macos-prereqs">macOS Prerequisites (optional)</a>.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="_ansible_variables_for_http_https_proxy">Ansible Variables for HTTP/HTTPS Proxy</h4>
<div class="paragraph">
<p>Set these variables in an Inventory file, or with CLI.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">This URL is pasted into <code>http_proxy</code> and <code>https_proxy</code> environment variables. Syntax: <code><a href="http://&lt;proxy-host&gt;:&lt;proxy-port&gt" class="bare">http://&lt;proxy-host&gt;:&lt;proxy-port&gt</a>;</code> or <code><a href="http://&lt;proxy_user&gt;:&lt;proxy_pass&gt;@&lt;proxy-host&gt;:&lt;proxy-port&gt" class="bare">http://&lt;proxy_user&gt;:&lt;proxy_pass&gt;@&lt;proxy-host&gt;:&lt;proxy-port&gt</a>;</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The host address of the proxy server. e.g. <code>127.0.0.1</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port number of the proxy e.g. <code>8080</code></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if proxy authentication is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required if proxy authentication is enabled</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Optional. The protocol to use with the proxy. Default value is <code>http</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="_using_external_tools_with_http_https_proxy">Using External Tools with HTTP/HTTPS Proxy</h4>
<div class="paragraph">
<p>If you want to use the external tools with HTTP/HTTPS proxy, you will have to manually update the configuration for those tools in the Jenkinsfile, using the values from the environment variables such as <code>HTTP_PROXY</code> and <code>HTTPS_PROXY</code>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="macos-setup">Setup macOS Servers (optional)</h3>
<div class="paragraph">
<p>Set the required variables to make installer provision a macOS server.</p>
</div>
<div class="olist arabic">
<div class="title">Steps done by installer to provision a macOS server</div>
<ol class="arabic">
<li>
<p>Install Homebrew</p>
</li>
<li>
<p>Install RVM and Ruby</p>
</li>
<li>
<p>Install NVM and Node</p>
</li>
<li>
<p>Install Xcode</p>
</li>
<li>
<p>Download Apple certificates</p>
</li>
<li>
<p>Update Cocoapods</p>
</li>
<li>
<p>Register macOS Server as a node in Jenkins</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_required_ansible_variables_for_macos_server_provisioning">Required Ansible Variables for macOS server provisioning</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xcode_install_user</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account username. If not set, Xcode installation will
be skipped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>xcode_install_password</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account password. If not set, Xcode installation will
be skipped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>credential_private_key_path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the private key that Jenkins should use to SSH into the macOS node.
If not set, the Jenkins node configuration will be skipped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>credential_passphrase</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passphrase for the private key. If not set, the Jenkins node
configuration will be skipped.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>credential_public_key_path</code></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to the public key. The macOS node will add this to it&#8217;s
<code>authorized_keys</code> file. If not set, the Jenkins node configuration will
be skipped.</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">Example: Command setting required variables to start the Digger Ansible job to provision macOS server:</div>
<div class="content">
<pre>ansible-playbook -i sample-inventory-file sample-playbook.yml
-e "ansible_sudo_pass=exampleSudoPassword"
-e "xcode_install_user=exampleAppleDeveloperUsername"
-e "xcode_install_password=exampleAppleDeveloperPassword"
-e "credential_private_key_path=/path/to/sshKey"
-e "credential_passphrase=exampleSshKeyPassphrase"
-e "credential_public_key_path=/path/to/sshKey.pub"
--tags="provision-osx"</pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_further_macos_configuration_options">Further macOS Configuration options</h4>
<div class="paragraph">
<p>Further configuration of the macOS node is possible through optional
<a href="#macos-variables">macOS variables</a>.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="run-digger-installer">Run Digger Installer</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Clone <a href="https://github.com/aerogear/aerogear-digger-installer" target="_blank" rel="noopener">Digger Installer GitHub repo</a>.</p>
</li>
<li>
<p>Make a copy of the Ansible <a href="https://github.com/aerogear/aerogear-digger-installer/blob/master/inventory-sample" target="_blank" rel="noopener">inventory-sample</a>, and update it with information about your infrastructure.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
For a full list of variables that can be configured via the inventory file, refer to <a href="#installer-variables">Installer Variables</a>.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Use one of these commands to run the playbook and follow the instructions printed in the terminal:</p>
<div class="ulist">
<ul>
<li>
<p>Command to install Digger with macOS server</p>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Make sure your macOS Server is prepared for installation. See <a href="macos-prereqs">macOS Prerequisities</a>.
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="content">
<pre>ansible-playbook -i &lt;your-inventory-sample&gt; sample-build-playbook.yml</pre>
</div>
</div>
</li>
<li>
<p>Command to install Digger without a macOS server</p>
<div class="listingblock">
<div class="content">
<pre>ansible-playbook -i &lt;your-inventory-sample&gt; sample-build-playbook.yml --skip-tags=provision-osx</pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As of Jan 4th 2018, only <code>provision-osx</code> tag is working with with <code>--skip-tags</code>.
</td>
</tr>
</table>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>Perform nonautomated tasks manually:</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Accept Android SDK licence</p>
<div class="ulist">
<ul>
<li>
<p>During initial Android SDK installation</p>
</li>
<li>
<p>During sync of Android SDK versions</p>
</li>
</ul>
</div>
</li>
<li>
<p>If you are provisioning a macOS Server:</p>
<div class="ulist">
<ul>
<li>
<p>Copy server&#8217;s public SSH key(server that is running Ansible) into Jenkins Slave running on macOS server</p>
</li>
<li>
<p>Accept the Oracle License when installing Java on macOS server</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">Ansible playbook will perform the following tasks:</div>
<ul>
<li>
<p>Check if the required Java version is installed, install/upgrade if not,</p>
</li>
<li>
<p>Create an OpenShift project,</p>
</li>
<li>
<p>Install Jenkins (Master) on OpenShift,</p>
</li>
<li>
<p>Install Android SDK to a Persistent Volume,</p>
</li>
<li>
<p>Configure Jenkins Master,</p>
</li>
<li>
<p>Setup macOS Server(s) (optional). <a href="macos-prereqs">Manual pre-provisioning is required.</a></p>
</li>
<li>
<p>Install Nagios on OpenShift,</p>
</li>
<li>
<p>Print URL and credentials for Jenkins and Nagios.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_nagios_installation_health_checks">Nagios Installation Health checks</h3>
<div class="paragraph">
<p>To monitor the status of Digger components, the Digger installer will also install <a href="https://www.nagios.org/" target="_blank" rel="noopener">Nagios</a> and several Nagios checks. At the end of the installation, Ansible will trigger the checks and output the results.</p>
</div>
<div class="olist arabic">
<div class="title">To navigate to Nagios checks:</div>
<ol class="arabic">
<li>
<p>Log in to Nagios using the URL and credentials printed in the terminal at the end of the installation.</p>
</li>
<li>
<p>Navigate to the Services Link.</p>
</li>
<li>
<p>Verify that all Nagios checks are passing.</p>
</li>
</ol>
</div>
<div class="ulist">
<div class="title">The environment specific checks carried out by Nagios are:</div>
<ul>
<li>
<p>Container CPU Usage</p>
</li>
<li>
<p>Container Memory Usage</p>
</li>
<li>
<p>Container Resource Limits</p>
</li>
<li>
<p>Pod Disk Storage</p>
</li>
</ul>
</div>
<div class="ulist">
<div class="title">The Digger specific checks carried out by Nagios are:</div>
<ul>
<li>
<p>Availability of the Jenkins container (pod)</p>
</li>
<li>
<p>Status of the network link between Jenkins and the macOS servers</p>
</li>
<li>
<p>Status of the Android SDK PersistentVolumeClaim</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="installer-variables">Installer Variables</h3>
<div class="paragraph">
<p>This section describes all installer variables organized by tags.</p>
</div>
<div class="paragraph">
<p>For more information about these variables, see the <a href="https://github.com/aerogear/aerogear-digger-installer" target="_blank" rel="noopener">Digger Installer repo</a></p>
</div>
<div class="paragraph">
<p>You must provide a value for all required variables or accept the default value.</p>
</div>
<div class="paragraph">
<p>You can specify a value using one of the following methods:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>enter a value into the inventory file</p>
</li>
<li>
<p>specify a value on the command line</p>
</li>
<li>
<p>using an encrypted <a href="http://docs.ansible.com/ansible/latest/playbooks_vault.html" target="_blank" rel="noopener">Ansible Vault</a> file.</p>
</li>
</ul>
</div>
<div class="sect3">
<h4 id="variables-android-sdk">android-sdk</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">android_sdk_home</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location of Android SDK that is installed in the Android SDK container.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/opt/android-sdk-linux</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-configure-buildfarm">configure-buildfarm</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the OpenShift project.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">digger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">add_public_key_automatically</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether to add SSH public key to Jenkins configuration automatically.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">true</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_oauth_token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OAuth token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;oauth_token&gt;</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, if <code>add_public_key_automatically</code> is set to <code>true</code> and <code>enable_oauth</code> is set to <code>true</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">concurrent_android_builds</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Max. number of concurrent Android builds.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">5</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_private_key_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins SSH private key password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">None</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes, if password protected</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_private_key_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins SSH private key location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~/.ssh/id_rsa</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_public_key_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins SSH public key location</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">~/.ssh/id_rsa.pub</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_route_protocol</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Route protocol used to connect to Jenkins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">https</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-deploy-jenkins">deploy-jenkins</h4>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the OpenShift project.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">digger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">enable_oauth</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Determines whether to enable OAuth OpenShift integration. If <code>false</code>, a static account will be created.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">false</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">master_memory_limit</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Maximum amount of memory the Jenkins master container can use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">3Gi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">master_volume_capacity</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Volume space available for data.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">40Gi</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-deploy-nagios">deploy-nagios</h4>
<div class="paragraph">
<p>Variables used to configure Nagios for sending alert emails.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp_server</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP server to send alert emails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp_username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP username.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password of the SMTP user.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">smtp_from_address</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">SMTP sender address.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="mailto:admin@example.com">admin@example.com</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rhmap_admin_email</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Destination address of alert emails.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">root@localhost</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User who queries Jenkins during Nagios checks.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">jenkins_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">User password for &lt;jenkins_user&gt;.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-java">java</h4>
<div class="paragraph">
<p>Variables used to configure JDK on the remote host that runs Jenkins CLI commands.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">repo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The repository used to install JDK.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">rhel-7-server-optional-rpms</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">java_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">JDK version to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.8.0</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-login">login</h4>
<div class="paragraph">
<p>Variables used to login to the OpenShift Cluster.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
<th class="tableblock halign-left valign-top">Default value</th>
<th class="tableblock halign-left valign-top">Required</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oc_user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">OpenShift user who log into OpenShift.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">oc_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Password for &lt;oc_user&gt;.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">login_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL used to log in to OpenShift.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://localhost:8443" class="bare">https://localhost:8443</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect3">
<h4 id="variables-provision-osx">provision-osx</h4>
<div class="paragraph">
<p>Variables used while provisioning a macOS node.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Default value</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Required</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ansible_become_pass</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Sudo password required to perform root privileged actions on a macOS server. Typically, this is specified using the command line.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">remote_tmp_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Location for temporary files.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/tmp</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node_versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A comma separated list of Node versions to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">6</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of the xcode-install tool to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2.2.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gem_packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of gem packages to install.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>gem_packages:
- name: public_suffix
  version: 2.0.5
- name: xcode-install
  version: "{{xcode_install_version}}"</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cocoapods_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of the Cocoapods gem to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.1.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm_packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of global NPM packages to install.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>npm_packages:
- name: cordova
  version: 7.0.1</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_packages</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The packages to install using Homebrew.</p></td>
<td class="tableblock halign-left valign-top"><div><div class="listingblock">
<div class="content">
<pre>homebrew_packages:
- name: gpg
- name: grep
- name: jq</pre>
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of Homebrew to install (git tag).</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1.3.1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_repo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The git repo for the version of Homebrew to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="https://github.com/Homebrew/brew" class="bare">https://github.com/Homebrew/brew</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_prefix</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The parent directory for the Homebrew location.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_install_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location where Homebrew is installed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;homebrew_prefix&gt;/Homebrew</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_brew_bin_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The location where <code>brew</code> is installed.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/usr/local/bin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_paths</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;homebrew_install_path&gt;, &lt;homebrew_brew_bin_path&gt;, &lt;homebrew_var_path&gt;, /usr/local/Cellar, /usr/local/opt, /usr/local/share, /usr/local/etc, /usr/local/include</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_taps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of Homebrew taps to add.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew/core, caskroom/cask</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account username. If this is not set then Xcode is not installed.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account password. If this is not set then Xcode is not installed.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_session_token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account auth cookie from <code>fastlane spaceauth</code> command (For accounts with 2FA enabled).</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of Xcode versions to install, can take over 30 minutes each to install.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">'8.3.3'</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_default_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The default version of Xcode to use</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">&lt;xcode_version&gt;[0]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apple_wwdr_cert_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple WWDR certificate URL. Defaults to Apple&#8217;s official URL.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><a href="http://developer.apple.com/certificationauthority/AppleWWDRCA.cer" class="bare">http://developer.apple.com/certificationauthority/AppleWWDRCA.cer</a></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apple_wwdr_cert_file_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Output file name of the downloaded WWDR certificate file.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">AppleWWDRCA.cer</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used to connect to the macOS node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">22</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_root_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to Jenkins root folder.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">/Users/jenkins</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_credential_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifier for the Jenkins credential object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS_buildfarm_cred</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_credential_description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the Jenkins credential object.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Shared credential for the macOS nodes in the buildfarm.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the slave/node in Jenkins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS (&lt;node_host_address&gt;)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of labels assigned to the macOS node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">ios</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins user ID.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">admin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_executors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of executors (Jenkins configuration) on the macOS node.
There is currently no build isolation for the macOS node. This means there is
no guaranteed support for concurrent builds. This value should not be changed
unless you are certain all apps will be built with the same signature
credentials.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_mode</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">How the macOS node should be utilised. The following options are available:</p>
<p class="tableblock">* NORMAL
* EXCLUSIVE</p>
<p class="tableblock">Use EXCLUSIVE if you want build jobs with labels matching this node to only use this node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">NORMAL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the macOS node in Jenkins.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">macOS node for the buildfarm</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The name of the digger Project in OpenShift</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">digger</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_host</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy url/base hostname to be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if the macOS server only has outbound internet access via proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Proxy port to be used.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Yes if the macOS server only has outbound internet access via proxy</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_device</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The proxy network device to use for proxy configuration.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ethernet</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">proxy_ctx</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of proxies to use.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">webproxy, securewebproxy</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_lang_env_var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Value of <code>LANG</code> environment variable to set on the macOS node. CocoaPods requires a value of <code>en_US.UTF-8</code>.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">en_US.UTF-8</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_path_env_var</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><code>$PATH</code> environment variable to use in the macOS node.</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">$PATH:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_private_key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key stored in Jenkins and used to SSH into the macOS node. If this is not set, a key pair is generated.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_public_key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public key of the pair. If this is not set, a key pair is generated.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_passphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passphrase of the private key. This is stored in Jenkins and used to SSH into the macOS node. If this is not set, the private key is not password protected.</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">No</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="macos-variables">macOS Digger Variables</h3>
<div class="paragraph">
<p>This is a list of variables divided into sections, each for an individual macOS server provisioning step.</p>
</div>
<div class="sect3">
<h4 id="_install_homebrew">Install Homebrew</h4>
<div class="paragraph">
<p>This installation step will, along with Homebrew, also add taps and packages specified in the variables.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 2. <code>osx_install_homebrew</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of Homebrew to install (git tag).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_packages</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>The packages to install using Homebrew.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">homebrew_packages:
- name: &lt;PACKAGE_NAME&gt;
- name: &lt;PACKAGE_NAME&gt;</code></pre>
</div>
</div></div></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_repo</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The git repo where Homebrew resides (defaults to GitHub repo).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_prefix -homebrew_install_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where Homebrew will be installed, used as
<code>homebrew_prefix/homebrew_install_path</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_brew_bin_path</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Where brew will be installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">homebrew_taps</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of taps to add.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_install_ruby">Install Ruby</h3>
<div class="paragraph">
<p>This step installs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>RVM</p>
</li>
<li>
<p>Ruby (single version)</p>
</li>
<li>
<p><code>cocoapods</code> gem</p>
</li>
<li>
<p>Gems specified in <code>gem_packages</code></p>
</li>
</ul>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 3. <code>osx_install_ruby</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rvm_install_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of RVM installation script (defaults to GitHub release).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rvm_install_file_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Defines the installation filename on the node.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rvm_gpg_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The URL of the RVM-required gpg key.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">rvm_gpg_file_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">File name given to the GPG public key required to verify RVM.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ruby_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The version of Ruby to install.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">cocoapods_version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cocoapods gem version to install.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gem_packages</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A list of gems to install.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">gem_packages:
- name: &lt;PACKAGE_NAME&gt;
  version: &lt;PACKAGE_VERSION&gt;</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_install_node_js">Install Node.js</h3>
<div class="paragraph">
<p>Installs:
- NVM,
- Nodejs, (versions defined in variable)
- Optional packages from NPM, these will be installed globally.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 4. <code>osx_install_nodejs</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nvm_install_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">URL of NVM installation script (defaults to GitHub release).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">nvm_install_file_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Define the nvm Install filename on the node</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">node_versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of Node versions to install.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">npm_packages</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>A list of global NPM packages to install.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-yml" data-lang="yml">npm_packages:
- name: &lt;PACKAGE_NAME&gt;
  version: &lt;PACKAGE_VERSION&gt;</code></pre>
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_install_xcode">Install Xcode</h3>
<div class="paragraph">
<p>Installs:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>XCode CLI tools</p>
</li>
<li>
<p>XCode - specified version</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Installing a single version of XCode can take over 30 minutes, please be patient.
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_xcode_two_factor_authentication_2fa_support">Xcode Two Factor Authentication (2FA) Support</h4>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
You can disable 2FA in the Apple Developer Account for the duration of the Ansible job.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>If you have 2FA enabled for the specified Apple Developer Account then
you will need to set the <code>xcode_install_session_token</code> to a cookie
provided by authenticating with Apple. This can be done using Fastlane
Spaceship.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Fastlane 2.42.0 or higher is required
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">Obtaining Apple Developer cookie for 2FA Xcode installation</div>
<div class="content">
<pre>gem install fastlane -v '~&gt; 2.42.0'
fastlane spaceauth -u &lt;APPLE_DEVELOPER_USERNAME&gt;</pre>
</div>
</div>
<div class="paragraph">
<p>Follow the steps printed in the terminal. A cookie will be printed on the screen
after successful authentication.
Copy the cookie from <code>---\n</code> to the last <code>\n</code> and provide this as
the value for <code>xcode_install_session_token</code>.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 5. <code>osx_install_xcode</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_user</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account username. If this is not set then Xcode will not be
installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account password. If this is not set then Xcode will not be
installed.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_install_session_token</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple Developer Account auth cookie from <code>fastlane spaceauth</code> command (For
accounts with enabled 2FA).</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">xcode_versions</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A list of Xcode versions to install. Installation of each version may take over 30 minutes.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="_download_apple_certificates">Download Apple certificates</h3>
<div class="paragraph">
<p>Downloads required certificates into the node. Currently, only
Apple&#8217;s WWDR certificate is required. This certificate will be
downloaded into the user&#8217;s home directory.</p>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 6. <code>osx_download_certs</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apple_wwdr_cert_url</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Apple WWDR certificate URL. Defaults to Apple&#8217;s official URL</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">apple_wwdr_cert_file_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Filename of the downloaded certificate. Default is <code>AppleWWDRCA.cer</code>.</p></td>
</tr>
</tbody>
</table>
</div>
<div class="sect2">
<h3 id="_update_cocoapods">Update Cocoapods</h3>
<div class="paragraph">
<p>Executes pod repo update.</p>
</div>
</div>
<div class="sect2">
<h3 id="_configure_build_farm_node">Configure Build Farm node</h3>
<div class="paragraph">
<p>This step creates a credential set in the Build Farm for the macOS nodes using the
provided keys. Add each machine as a node in the Build Farm, connecting through SSH.</p>
</div>
<div class="paragraph">
<p>You need to create a key pair using <code>ssh-keygen</code>(or similar tool) to allow the
Jenkins instance to connect with the macOS nodes.</p>
</div>
<div class="sect3">
<h4 id="_generating_a_key_pair_with_ssh_keygen">Generating A Key Pair With ssh-keygen</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Run <code>ssh-keygen</code>. <code>-b</code> is number of bits (2048 by default), <code>-C</code> an optional comment.</p>
<div class="listingblock">
<div class="content">
<pre>ssh-keygen -t rsa -b 4096 -C "Digger-Jenkins-MacOS-Credentials"</pre>
</div>
</div>
</li>
<li>
<p>Select a location for the key pair along with a name.</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Enter file in which to save the key:
&gt; ~/.ssh/digger_macos_rsa</pre>
</div>
</div>
</li>
<li>
<p>Enter a secure passphrase:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; Enter passphrase (empty for no passphrase):
&gt; mySecurePassword</pre>
</div>
</div>
</li>
<li>
<p>Your key pair is available under the specified directory with the
specified name:</p>
<div class="listingblock">
<div class="content">
<pre>&gt; ls ~/.ssh/
digger_macos_rsa
digger_macos_rsa.pub</pre>
</div>
</div>
</li>
</ol>
</div>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 7. <code>osx_configure_buildfarm</code> variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_private_key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Private key stored in Jenkins and used to SSH into the macOS node. If not set, a key pair will be generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_public_key</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Public key of the pair. If not set, a key pair will be generated.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">credential_passphrase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Passphrase protecting the private key. This is stored in Jenkins and used to SSH into the macOS node. If not set, the private key will not be password protected.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_port</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">The port used to connect to the macOS node. Default is <code>22</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_root_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Path to Jenkins root folder. Default is <code>/Users/jenkins</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_credential_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Identifier for the Jenkins credential object. Default is
<code>macOS_buildfarm_cred</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_credential_description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the Jenkins credential object.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the slave/node in Jenkins. Default is <code>macOS (&lt;node_host_address&gt;)</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_labels</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">List of labels assigned to the macOS node. Default is <code>ios</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_user_id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Jenkins user ID. Default is <code>admin</code>.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_executors</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Number of executors (Jenkins configuration) on the macOS node. Default is
<code>1</code>. Currently, there is no build isolation with the macOS node, that means there is no guaranteed support for concurrent iOS builds. Run concurrent builds only if ALL apps are to be built with the same signature credentials.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_description</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Description of the macOS node in Jenkins.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">buildfarm_node_mode &lt;MODE&gt;</p></td>
<td class="tableblock halign-left valign-top"><div><div class="paragraph">
<p>How the macOS node should be utilised. The following options are available:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;MODE&gt; = NORMAL</pre>
</div>
</div>
<div class="paragraph">
<p>Use this node as much as possible</p>
</div>
<div class="listingblock">
<div class="content">
<pre>&lt;MODE&gt; = EXCLUSIVE</pre>
</div>
</div>
<div class="paragraph">
<p>Only build jobs with labels matching this node will use this node.</p>
</div></div></td>
</tr>
</tbody>
</table>
<table class="tableblock frame-all grid-all spread">
<caption class="title">Table 8. Other variables</caption>
<colgroup>
<col style="width: 50%;">
<col style="width: 50%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Variable name</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">remote_tmp_dir</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">A directory where downloaded scripts and other miscellaneous files can be
stored for the duration of the job.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">project_name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Name of the Jenkins project in OpenShift. Defaults to <code>jenkins</code>.</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect2">
<h3 id="known-issues">Known Issues</h3>
<div class="sect3">
<h4 id="_issues_with_using_http_proxy">Issues with using HTTP Proxy</h4>
<div class="sect4">
<h5 id="_http_proxy_with_macos_jenkins_node">HTTP proxy with macOS Jenkins node</h5>
<div class="paragraph">
<p>When configuring Jenkins to run behind a HTTP proxy, there is a <a href="https://issues.jenkins-ci.org/browse/JENKINS-31464" target="_blank" rel="noopener">limitation/bug</a> in the way slave nodes use the Git plugins. This is because the slaves inherit proxy information from the master.</p>
</div>
<div class="paragraph">
<p>The result is that a macOS node (the Jenkins slave responsible for iOS builds), will attempt to checkout application source code through a HTTP proxy address and port if one has been specified during the provisioning of Digger.</p>
</div>
<div class="paragraph">
<p>This may not be an issue if the slave exists on the same network, but can be an issue  if it exists on network outside the OpenShift cluster. Two potential workarounds exist:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add networking rules to allow the macOS server to route requests through the proxy. This is the recommended approach as it allows you to keep your Jenkins configuration intact.</p>
</li>
<li>
<p>Remove the proxy configuration in Jenkins &gt; Manage Jenkins &gt; Manage Plugins &gt; Advanced. If you then need to checkout source code behind a proxy for specific builds, the required configuration steps can be added to the Jenkinsfile when necessary.</p>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_http_proxy_authentication_in_android_builds">HTTP proxy authentication in Android builds</h5>
<div class="paragraph">
<p>When building Android apps, the pod in which the apps are built cannot use a proxy that requires authentication. This is due to an issue within Gradle.</p>
</div>
</div>
<div class="sect4">
<h5 id="_android_sdk_manager_tools_don_t_support_http_proxy_with_authentication">Android SDK Manager tools don&#8217;t support HTTP proxy with authentication</h5>
<div class="paragraph">
<p>(Regarding installation of Android SDK into the Android SDK OpenShift pod during provisioning).</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_issues_with_ansible_provisioning">Issues with Ansible provisioning</h4>
<div class="sect4">
<h5 id="_encrypted_private_key_cannot_be_provided_in_ansible_provisioning">Encrypted private key cannot be provided in Ansible provisioning</h5>
<div class="paragraph">
<p>The user&#8217;s private key cannot be encrypted when running the Ansible playbook.</p>
</div>
<div class="paragraph">
<p>Note that this does not include the key pair that should be provided when provisioning the macOS node, the private key of the macOS key pair should be encrypted with a passphrase.</p>
</div>
<div class="paragraph">
<p>The workaround is to use <code>openssl</code> to remove the passphrase from your key using the following command.</p>
</div>
<div class="listingblock">
<div class="content">
<pre>openssl rsa -in ~/.ssh/id_rsa -out ~/.ssh/id_rsa_new</pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_ios_build_limitations">iOS Build Limitations</h4>
<div class="sect4">
<h5 id="_no_build_isolation_support">No Build Isolation Support</h5>
<div class="paragraph">
<p>At the moment(November 2017), the iOS builds do not support build isolation. This means if one iOS build process changes the settings/environment, it will impact all iOS build processes.</p>
</div>
</div>
<div class="sect4">
<h5 id="_no_parallel_build_support_on_a_single_macos_server">No Parallel Build Support On A Single macOS Server</h5>
<div class="paragraph">
<p>Each iOS build needs to update parts of the global configuration (certifications, keys etc). If you need to support parallel iOS builds, you will need to configure multiple macOSservers.</p>
</div>
</div>
</div>
</div>
</div>
</div>
      
      </div><!-- col 8 -->
    </div><!-- row -->
  </div><!-- container -->
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        <h5>Getting Started</h5>
        <ul class="list-unstyled">
          <li><a href="/getting-started/overview/">Overview</a></li>
          <li><a href="/getting-started/installation-and-configuration/">Installation &amp; Configuration</a></li>
          <li><a href="/getting-started/creating-mobile-apps/">Creating Mobile Apps</a></li>
          <li><a href="/getting-started/enabling-mobile-services/">Enabling Mobile Services</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile Services</h5>
        <ul class="list-unstyled">
         <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
         <li><a href="/services/push/">Push Notifications</a></li>
         <li><a href="/services/metrics/">Metrics</a></li>
         <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
         <li><a href="/services/identity-management/">Identity Management</a></li>
         <li><a href="/services/device-security/">Device Security</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile SDKs</h5>
        <ul class="list-unstyled">
         <li><a href="/sdks/android/">Android</a></li>
         <li><a href="/sdks/cordova/">Cordova</li>
         <li><a href="/sdks/ios/">iOS</a></li>
         <li><a href="/sdks/xamarin/">Xamarin</a></li>
        </ul>
      </div><!-- col -->
      
      <div class="col-sm-3">
        <h5>COMMUNITY</h5>
        <ul class="list-unstyled">
          <li><a target="_blank" href="https://github.com/aerogear/">GitHub - Aerogear</a></li>
          <li><a target="_blank" href="https://github.com/aerogearcatalog/">GitHub - Aerogear Catalog</a></li>
          <li><a target="_blank" href="https://issues.jboss.org/browse/AEROGEAR">Jira Repo Issues</a></li>
          <li><a  href="/community/contribution-guide/">Contribution Guide</a></li>
          <li><a target="_blank" href="https://groups.google.com/forum/#!forum/aerogear">Google Group</a></li>
          <li><a href="irc://irc.freenode.net/aerogear">IRC</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-12 follow">
        <h5>FOLLOW US</h5>
        <ul class="list-inline">
          <li><a target="_blank" href="https://www.twitter.com/aerogears"><i class="fa fa-twitter-square"></i> Twitter</a></li>
          <li><a target="_blank" href="https://www.facebook.com/AeroGearProject"><i class="fa fa-facebook-square"></i> Facebook</a></li>
          <li><a target="_blank" href="https://plus.google.com/106588661437153585722/posts"><i class="fa fa-google-plus-square"></i> Google+</a></li>
          <li><a target="_blank" href="/feed.atom"><i class="fa fa-rss-square"></i> Feed</a></li>
        </ul>
        
        <p>AeroGear project is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a></p>
      </div><!-- col -->
    
    </div><!-- row -->

  </div><!-- container -->

</footer><!-- footer -->

<section class="redhat">
  <div class="container">
    <p class="text-center">
      <a href="http://www.redhat.com/">
        <img src="/img/redhatlogo-wite.png" alt="redhatlogo-wite" width="130">
      </a>
    </p>       
  </div><!-- container -->
</section>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- <script src="/bower_components/jquery/dist/jquery.min.js"></script> -->

<!-- Include all compiled plugins (below), or include individual files as needed  -->  
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- My script -->
<script src="/js/script.js"></script>

</body>
</html>