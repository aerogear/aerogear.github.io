<!doctype html>
<html>
<head>
  <title>AeroGear - Sending Push Notifications to Chrome Packaged Apps with AeroGear's UnifiedPush Server</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="utf-8">

  <!-- Main styles-->
  <link href="/css/styles.css" rel="stylesheet" media="screen">

  <!-- Syntax highlighting -->
  <link href="/css/syntax.css" rel="stylesheet"> 

  <!-- Icons -->
  <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">
  <link href="/css/openshift-icons.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  
  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" type="image/x-icon">

  <script src="//code.jquery.com/jquery-1.9.1.min.js"></script>


  <!-- google analytics -->
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-28733717-2']);
      _gaq.push(['_setDomainName', 'aerogear.org']);
      _gaq.push(['_trackPageview']);

      (function () {
          var ga = document.createElement('script');
          ga.type = 'text/javascript';
          ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0];
          s.parentNode.insertBefore(ga, s);
      })();
  </script>
  

</head>

<body>    

<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/index.html">AeroGear</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        

        <li class="">
          <a href="/">Home</a>
        </li>

        <li class="">
          <a href="/getting-started/overview/">Getting Started</a>
        </li>


        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile Services<span class="caret"></span></a>
            <ul class="dropdown-menu" role="menu">
              <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
              <li><a href="/services/push/">Push Notifications</a></li>
              <li><a href="/services/metrics/">Metrics</a></li>
              <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
              <li><a href="/services/identity-management/">Identity Management</a></li>
              <li><a href="/services/device-security/">Device Security</a></li>
            </ul>
        </li>

        <li class="dropdown ">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Mobile SDKs<span class="caret"></span></a>
          <ul class="dropdown-menu" role="menu">
            <li><a href="/sdks/android/">Android</a></li>
            <li><a href="/sdks/cordova/">Cordova</li>
            <li><a href="/sdks/ios/">iOS</a></li>
            <li><a href="/sdks/xamarin/">Xamarin</a></li>
          </ul>
        </li>

        <li class="hidden-sm ">
          <a href="https://docs.aerogear.org">Docs</a>
        </li>
   
        
        <li class="">
          <a href="/community">Community</a>
        </li>
        

        <li class="">
          <a href="/news">News</a>
        </li>
        
      </ul>

    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>

<section class="main-banner">
  <div class="container">
    
  <h2>Aerogear Guides <small>Tutorials to help get you off and running.</small></h2>

  </div><!-- container -->
</section> <!-- main banner -->


<section class="guides">
  
  <div class="container">
         <ol class="breadcrumb" style="margin:0">
      <li>
        
          <a href="/getstarted/guides/">Guides</a>
        
      </li>
      <li class="active">Sending Push Notifications to Chrome Packaged Apps with AeroGear's UnifiedPush Server</li>
    </ol>
  </div><!-- container -->


  <div class="container">
    <div class="row">
      
      <div class="col-md-3 hidden-sm hidden-xs sidebar">
        <ul class="nav">
   <li class="toc_level-1 toc_section-1">
      <a href="#google-setup">
         <span class="toctext">Google Related Setup</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-2">
            <a href="#_registering_with_google">
               <span class="toctext">Registering with Google</span>
            </a>
         </li>
      </ul>
   </li>
   <li class="toc_level-1 toc_section-3">
      <a href="#register-device">
         <span class="toctext">The AeroGear UnifiedPush Server</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-4">
            <a href="#_aerogear_unifiedpush_server">
               <span class="toctext">AeroGear UnifiedPush Server</span>
            </a>
         </li>
      </ul>
   </li>
   <li class="toc_level-1 toc_section-5">
      <a href="#chrome-app">
         <span class="toctext">Your first Chrome/Push App</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-6">
            <a href="#_creating_the_application">
               <span class="toctext">Creating the application</span>
            </a>
         </li>
      </ul>
   </li>
   <li class="toc_level-1 toc_section-7">
      <a href="#push-notification">
         <span class="toctext">Send a Push Notification</span>
      </a>
      <ul>
         <li class="toc_level-2 toc_section-8">
            <a href="#_simple_sender">
               <span class="toctext">Simple Sender</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-9">
            <a href="#_you_are_done">
               <span class="toctext">You are done</span>
            </a>
         </li>
         <li class="toc_level-2 toc_section-10">
            <a href="#_last_minute_notes">
               <span class="toctext">Last-Minute Notes</span>
            </a>
         </li>
      </ul>
   </li>
</ul>
      </div><!-- col -->
      
      <div class="col-md-9 post">
      
        <h1>Sending Push Notifications to Chrome Packaged Apps with AeroGear's UnifiedPush Server</h1>
        <div class="paragraph">
<p>The following step-by-step guides, gives you an introduction on how to use the AeroGear UnifiedPush Server for sending Push Notifications to your own Chrome Packaged Apps using the same Google Cloud Messaging(GCM) service that Android uses. You will need a Google account to use Google&#8217;s services. So, letâ€™s get started:</p>
</div>
<div class="sect1">
<h2 id="google-setup">Google Related Setup</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Before the Chrome Packaged application is able to receive the notifications, you must authenticate yourself with Google as a developer. Luckily this is both easy and free to do, and doesn&#8217;t require much set-up.</p>
</div>
<div class="sect2">
<h3 id="_registering_with_google">Registering with Google</h3>
<div class="paragraph">
<p>First, we must authenticate with Google. You will need a Google Account for this. Now open the <a href="https://cloud.google.com/console">Google Cloud Console</a>.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If you haven&#8217;t created a project, click ``Create Project'':</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_1.png" alt="Create New Project"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Now give the new project a name:</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_2.png" alt="New Project Name"></span></p>
</div>
<div class="ulist">
<ul>
<li>
<p>Once the project has been created you will see the overview screen. From there grab the project number (used later as the <em>Sender ID</em>):</p>
</li>
</ul>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_3.png" alt="Project Number"></span></p>
</div>
<div class="paragraph">
<p>Since Chrome Packaged Apps use the same <em>Google Cloud Messaging for Android APIs</em>, we will need to enable them. To do that, navigate to APIs &amp; auth &gt; APIs and scroll down to the _Google Cloud Messaging for Android item, which you need to turn on:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_4.png" alt="Project Number"></span></p>
</div>
<div class="paragraph">
<p>Now we need to register our application and state that we are accessing the Google APIs from a <em>Web Server</em>, the <em>AeroGear UnifiedPush Server</em> in this case. First go to APIs &amp; auth &gt; Credentials and inside of the <em>Public API access</em> area click the blue <strong>CREATE NEW KEY</strong> button. This launches the following popup, where you select the Server key option:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_5.png" alt="Project Number"></span></p>
</div>
<div class="paragraph">
<p>On the next screen we just click the blue Create button to create our Server Key:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_6.png" alt="Project Number"></span>
- For extra security, you may whitelist an IP address (or multiple) for the sending server</p>
</div>
<div class="paragraph">
<p>On the last screen we are finally get to see the actual value of the generated Server Key, which we will use later:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/gcc_7.png" alt="Project Number"></span></p>
</div>
<div class="paragraph">
<p>Now that Google is ready to accept and deliver our messages, we are ready to setup the <a href="#register-device">UnifiedPush server</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="register-device">The AeroGear UnifiedPush Server</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that all the Google work is done, we are now ready to setup the <a href="https://github.com/aerogear/aerogear-unified-push-server">UnifiedPush Server</a>, so that it can be used to connect to CGM for sending messages later in the tutorial.</p>
</div>
<div class="sect2">
<h3 id="_aerogear_unifiedpush_server">AeroGear UnifiedPush Server</h3>
<div class="paragraph">
<p>The <em>AeroGear UnifiedPush Server</em> defines a logical <em>abstraction</em> for Mobile Applications that have support for different Push Networks. Its <em>Push Applications</em> can have different "Variants". For this tutorial we&#8217;ll need to create a <em>Push Application</em> which will contain one Chrome Packaged App Variant.</p>
</div>
<div class="paragraph">
<p>Details on the AeroGear UnifiedPush Server are discussed <a href="../../ups_userguide/index/">here</a>.</p>
</div>
<div class="paragraph">
<p>Once you have run through the <a href="../../ups_userguide/index/#server-installation">Installation</a> and <a href="../../ups_userguide/index/#_login_and_landing_page">Login</a> Procedures, meet me back here.  I&#8217;ll wait.</p>
</div>
<div class="paragraph">
<p>Ok, now that your back, lets continue.</p>
</div>
<div class="paragraph">
<p>For the purpose of the guide, we will be using the AdminUI and assuming that you have followed the previous guide to login and setup your UnifiedPush Server environment.</p>
</div>
<div class="paragraph">
<p>include:docs/unifiedpush/include&#8212;&#8203;register-app.asciidoc[]</p>
</div>
<div class="paragraph">
<p>You may be wondering why we are creating an Android Variant for a Chrome app.  Well, the previous <a href="https://developer.chrome.com/extensions/pushMessaging">chrome.pushMessaging API</a> has been deprecated since chrome 38 and will be removed soon.  This has been replaced with the <a href="https://developer.chrome.com/extensions/gcm">chrome.gcm API</a>, which uses the same GCM as Android.  This allows us to use the Android Variant for Chrome Apps!!</p>
</div>
<div class="paragraph">
<p>Click the <strong>Add Variant</strong> button. And fill out the Android options.  You will want to use the <strong>Client ID</strong> and <strong>Project Number</strong> from the <strong>Google API Console</strong> in their appropriate fields.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/variant_02.png" alt="Android Variant Options"></span></p>
</div>
<div class="paragraph">
<p>Click <strong>Add</strong> and your variant will be created.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/variant_03.png" alt="Android Variant Created"></span></p>
</div>
<div class="paragraph">
<p>Expand the variant card and make note of the <strong>Variant ID</strong> and <strong>Secret</strong> fields. Both will be used later when registering your installation through the Android client SDK.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../../../aerogear-push-android/img/variant_04.png" alt="Android Variant Details"></span></p>
</div>
<div class="paragraph">
<p>The server is now configured. Time to <a href="#chrome-app">create a Chrome Packaged Application</a> that will use the AeroGear JS library to connect to the UnifiedPush server and start receiving notifications.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="chrome-app">Your first Chrome/Push App</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that the UnifiedPush server is up and running, time to create a sample application that will exercise AeroGear&#8217;s Chrome Push library support.</p>
</div>
<div class="paragraph">
<p>Let&#8217;s get started!</p>
</div>
<div class="sect2">
<h3 id="_creating_the_application">Creating the application</h3>
<div class="paragraph">
<p>Since a Chrome Packaged Application is just a Web Application consisting of HTML, Javascript and CSS, you can use any editor you feel comfortable with.</p>
</div>
<div class="paragraph">
<p>Here is an example of what the directory structure will look like</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../img/app_1.png" alt="App Structure"></span></p>
</div>
<div class="paragraph">
<p>You can download AeroGear.js <a href="https://github.com/aerogear/aerogear-js-dist/releases/latest">here</a> and the jQuery library <a href="http://jquery.com/download/">here</a></p>
</div>
<div class="paragraph">
<p>We will create the remaining files.</p>
</div>
<div class="paragraph">
<p>The first thing we need to do is create a manifest.json file and add the <em>gcm</em> permission:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    "name": "NAME OF YOUR APP",
    "version": "1",
    "manifest_version": 2,
    "description": "DESCRIPTION OF YOUR APP",
    "icons": {
        "16": "images/icon-16.png",
        "128": "images/icon-128.png"
    },
    "app": {
        "background": {
          "scripts": ["scripts/main.js", "scripts/jquery.min.js", "scripts/aerogear.js"]
        }
    },
    "permissions": ["gcm"]
}</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<em>To Learn more about what the manifest file is, <a href="http://developer.chrome.com/apps/manifest">go here</a></em>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Now we need to create our "background event" script, which will be our main.js file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">chrome.app.runtime.onLaunched.addListener(function() {
    chrome.app.window.create('index.html', {
        width: 500,
        height: 309
    });
});

// This will happen when the app is first Installed
chrome.runtime.onInstalled.addListener(function() {

    // First we need to register our senderId with GCM and then send the returned registrationId to the UnifiedPush Server
    // This code could also go in the 'onLaunched' method

    chrome.gcm.register(['YOUR_SENDERID'], function (registrationId) {
        /*
            Set our Variant ID and Secret and the location of the UnifiedPush Server
        */
        var variantId = "VARIANT_ID",
            variantSecret = "VARIANT_SECRET",
            pushServerURL = "http://localhost:8080/ag-push";

        // Once we have the registrationId we can then register with the UnifiedPush Server using
        // the AeroGear.js library
        var client = AeroGear.UnifiedPushClient(
                variantId,
                variantSecret,
                pushServerURL
            ),settings = {};
            // The channelId will be the "device token"

        settings.metadata = {
            deviceToken: registrationId
        };

        // Register with the UnifiedPush Server
        client.registerWithPushServer( settings );

    });
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>The above code is responsible for registering with the UnifiedPush Server once the application is installed.</p>
</div>
<div class="paragraph">
<p><em class="NOTE">To learn more about the Chrome App Lifcycle, <a href="http://developer.chrome.com/apps/app_lifecycle">go here</a></em></p>
</div>
<div class="paragraph">
<p>With the "background" code out of the way, let now lets create a basic HTML page and call it index.html</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-html" data-lang="html">&lt;!doctype html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;meta charset="utf-8"&gt;
        &lt;title&gt;AeroGear Chrome App&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;AeroGear Chrome App&lt;/h1&gt;
        &lt;div id="messages"&gt;
            &lt;ul&gt;&lt;/ul&gt;
        &lt;/div&gt;
        &lt;script src="scripts/app.js"&gt;&lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>We also need to create our app.js:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-javascript" data-lang="javascript">// Here we listen for incoming messages from GCM and then we will just add them to our list
chrome.gcm.onMessage.addListener( function( message ) {
    var ul = document.querySelector('#messages ul'),
        li = document.createElement('li');

    li.innerHTML = message.data.alert;
    ul.appendChild( li );
});</code></pre>
</div>
</div>
<div class="paragraph">
<p>Now that we have our application up an running time to <a href="#push-notification">send messages</a> using the AeroGear UnifiedPush Server!</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="push-notification">Send a Push Notification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that we have the sample application running, it is time to use the <em>AeroGear UnifiedPush Server</em> for delivering a <em>Push Notification</em> message.</p>
</div>
<div class="sect2">
<h3 id="_simple_sender">Simple Sender</h3>
<div class="paragraph">
<p>We can use the UnifiedPush Server&#8217;s <em>Send</em> functionality to easily send a message</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../img/send_notification.png" alt="Send Message"></span></p>
</div>
<div class="paragraph">
<p>If all goes well, you should see the message payload being displayed on screen:</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="../img/notif_success.png" alt="Message Receiced-Active"></span></p>
</div>
</div>
<div class="sect2">
<h3 id="_you_are_done">You are done</h3>
<div class="paragraph">
<p>That&#8217;s all you need to use the <em>AeroGear</em> project for sending and receiving <em>Push Notifications</em> from a Chrome Packaged Application.</p>
</div>
</div>
<div class="sect2">
<h3 id="_last_minute_notes">Last-Minute Notes</h3>
<div class="paragraph">
<p>For a more information about GCM for Chrome, check out <a href="http://developer.chrome.com/apps/cloudMessaging">GCM Advanced Topics</a></p>
</div>
</div>
</div>
</div>
      
      </div><!-- col 8 -->
    </div><!-- row -->
  </div><!-- container -->
</section>



<footer>
  <div class="container">
    <div class="row">
      <div class="col-sm-3">
        <h5>Getting Started</h5>
        <ul class="list-unstyled">
          <li><a href="/getting-started/overview/">Overview</a></li>
          <li><a href="/getting-started/installation-and-configuration/">Installation &amp; Configuration</a></li>
          <li><a href="/getting-started/creating-mobile-apps/">Creating Mobile Apps</a></li>
          <li><a href="/getting-started/enabling-mobile-services/">Enabling Mobile Services</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile Services</h5>
        <ul class="list-unstyled">
         <li><a href="/services/mobile-ci-cd/">Mobile CI/CD</a></li>
         <li><a href="/services/push/">Push Notifications</a></li>
         <li><a href="/services/metrics/">Metrics</a></li>
         <li><a href="/services/runtime-connector/">Runtime Connector</a></li>
         <li><a href="/services/identity-management/">Identity Management</a></li>
         <li><a href="/services/device-security/">Device Security</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-3">
        <h5>Mobile SDKs</h5>
        <ul class="list-unstyled">
         <li><a href="/sdks/android/">Android</a></li>
         <li><a href="/sdks/cordova/">Cordova</li>
         <li><a href="/sdks/ios/">iOS</a></li>
         <li><a href="/sdks/xamarin/">Xamarin</a></li>
        </ul>
      </div><!-- col -->
      
      <div class="col-sm-3">
        <h5>COMMUNITY</h5>
        <ul class="list-unstyled">
          <li><a target="_blank" href="https://github.com/aerogear/">GitHub - Aerogear</a></li>
          <li><a target="_blank" href="https://github.com/aerogearcatalog/">GitHub - Aerogear Catalog</a></li>
          <li><a target="_blank" href="https://issues.jboss.org/browse/AEROGEAR">Jira Repo Issues</a></li>
          <li><a  href="/community/contribution-guide/">Contribution Guide</a></li>
          <li><a target="_blank" href="https://groups.google.com/forum/#!forum/aerogear">Google Group</a></li>
          <li><a href="irc://irc.freenode.net/aerogear">IRC</a></li>
        </ul>
      </div><!-- col -->

      <div class="col-sm-12 follow">
        <h5>FOLLOW US</h5>
        <ul class="list-inline">
          <li><a target="_blank" href="https://www.twitter.com/aerogears"><i class="fa fa-twitter-square"></i> Twitter</a></li>
          <li><a target="_blank" href="https://www.facebook.com/AeroGearProject"><i class="fa fa-facebook-square"></i> Facebook</a></li>
          <li><a target="_blank" href="https://plus.google.com/106588661437153585722/posts"><i class="fa fa-google-plus-square"></i> Google+</a></li>
          <li><a target="_blank" href="/feed.atom"><i class="fa fa-rss-square"></i> Feed</a></li>
        </ul>
        
        <p>AeroGear project is licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache 2.0 License</a></p>
      </div><!-- col -->
    
    </div><!-- row -->

  </div><!-- container -->

</footer><!-- footer -->

<section class="redhat">
  <div class="container">
    <p class="text-center">
      <a href="http://www.redhat.com/">
        <img src="/img/redhatlogo-wite.png" alt="redhatlogo-wite" width="130">
      </a>
    </p>       
  </div><!-- container -->
</section>


<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
<!-- <script src="/bower_components/jquery/dist/jquery.min.js"></script> -->

<!-- Include all compiled plugins (below), or include individual files as needed  -->  
<script src="/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>

<!-- My script -->
<script src="/js/script.js"></script>

</body>
</html>